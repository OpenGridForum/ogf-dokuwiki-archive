<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from redmine.ogf.org/projects/redmine-og/repository/revisions/7cdd88a6ce3632c801223b33e5ccc2b9fc13651e/diff by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Sep 2022 22:40:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>/ - Diff - Redmine - Open Grid Forum</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token"/>
<meta name="csrf-token" content="7RiXtn8JMoxXZTBSrtL64n0O2gGmxf69GTM4qjOvQSI="/>
<link rel='shortcut icon' href='https://redmine.ogf.org/favicon.ico?1425381960' />
<link href="https://redmine.ogf.org/themes/ogf_redmine/stylesheets/application.css?1425381960" media="all" rel="stylesheet" type="text/css" />

<script src="https://redmine.ogf.org/javascripts/prototype.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/effects.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/dragdrop.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/controls.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/application.js?1425381960" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){ new WarnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>

<!--[if IE 6]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1425381960);}
    </style>
<![endif]-->
<link href="https://redmine.ogf.org/plugin_assets/extended_fields/stylesheets/extended_fields.css?1425381960" media="screen" rel="stylesheet" type="text/css" /> <link href="https://redmine.ogf.org/plugin_assets/wiking/stylesheets/wiking.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->

<link href="https://redmine.ogf.org/stylesheets/scm.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="theme-Ogf redmine controller-repositories action-diff">
<div id="wrapper">
<div id="wrapper2">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="https://redmine.ogf.org/login" class="login">Login</a></li>
<li><a href="https://redmine.ogf.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="https://redmine.ogf.org/" class="home">Home</a></li>
<li><a href="https://redmine.ogf.org/projects" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    
    <div id="quick-search">
        <form action="https://redmine.ogf.org/search/index/redmine-og" method="get">
        <input name="changesets" type="hidden" value="1" />
        <label for='q'>
          <a href="https://redmine.ogf.org/search/index/redmine-og" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
        </form>
        
    </div>
    

    <h1><a href="https://redmine.ogf.org/projects/operations?jump=repository" class="root">Operations</a> » <a href="https://redmine.ogf.org/projects/it-og?jump=repository" class="ancestor">IT</a> » Redmine</h1>

    
    <div id="main-menu">
        <ul><li><a href="https://redmine.ogf.org/projects/redmine-og" class="overview">Overview</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/issues" class="issues">Issues</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/issues/calendar" class="calendar">Calendar</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/news" class="news">News</a></li>
<li><a href="https://redmine.ogf.org/dmsf/redmine-og" class="dmsf">Documents</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/wiki" class="wiki">Wiki</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/files" class="files">Files</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/repository" class="repository selected">Repository</a></li></ul>
    </div>
    
</div>

<div class="nosidebar" id="main">
    <div id="sidebar">
        
        
  
  


    </div>

    <div id="content">
        
        <h2>Revision 7cdd88a6 </h2>

<!-- Choose view type -->
<form action="https://redmine.ogf.org/projects/redmine-og/repository/diff" method="get">
  <input id="rev" name="rev" type="hidden" value="7cdd88a6ce3632c801223b33e5ccc2b9fc13651e" />
  
  <p>
    <label>View differences</label>
    <select id="type" name="type" onchange="if (this.value != '') {this.form.submit()}"><option value="inline" selected="selected">inline</option>
<option value="sbs">side by side</option></select>
  </p>
</form>


<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/controllers/projects_controller.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">52</th>
  <th class="line-num">52</th>
  <td class="line-code ">
    <pre>    respond_to do |format|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">53</th>
  <th class="line-num">53</th>
  <td class="line-code ">
    <pre>      format.html { 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">54</th>
  <th class="line-num">54</th>
  <td class="line-code ">
    <pre>        @project_tree = projects.group_by {|p| p.parent || p}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">55</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        @project_tree.<span>each_key</span> {|p| @project_tree[p] -= [p]} 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">55</th>
  <td class="line-code diff_in">
    <pre>        @project_tree.<span>keys.each</span> {|p| @project_tree[p] -= [p]} 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">56</th>
  <th class="line-num">56</th>
  <td class="line-code ">
    <pre>      }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">57</th>
  <th class="line-num">57</th>
  <td class="line-code ">
    <pre>      format.atom {
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">58</th>
  <th class="line-num">58</th>
  <td class="line-code ">
    <pre>        render_feed(projects.sort_by(&amp;:created_on).reverse.slice(0, Setting.feeds_limit.to_i), 
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/helpers/repositories_helper.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">22</th>
  <td class="line-code ">
    <pre>    txt.to_s[0,8]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">23</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">24</th>
  <td class="line-code ">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">25</th>
  <td class="line-code diff_in">
    <pre>  def to_path_param(path)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">26</th>
  <td class="line-code diff_in">
    <pre>    path.to_s.split(%r{[/\\]}).select {|p| !p.blank?}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">27</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">28</th>
  <td class="line-code diff_in">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num">29</th>
  <td class="line-code ">
    <pre>  def to_utf8(str)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>    return str if /\A[\r\n\t\x20-\x7e]*\Z/n.match(str) # for us-ascii
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">31</th>
  <td class="line-code ">
    <pre>    @encodings ||= Setting.repositories_encodings.split(',').collect(&amp;:strip)
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/models/user_preference.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">42</th>
  <th class="line-num">42</th>
  <td class="line-code ">
    <pre>    if attribute_present? attr_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">43</th>
  <th class="line-num">43</th>
  <td class="line-code ">
    <pre>      super
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">44</th>
  <th class="line-num">44</th>
  <td class="line-code ">
    <pre>    else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">45</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      self.others ||= {}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">46</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      self.others.store attr_name, value
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">45</th>
  <td class="line-code diff_in">
    <pre>      h = read_attribute(:others).dup || {}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">46</th>
  <td class="line-code diff_in">
    <pre>      h.update(attr_name =&gt; value)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">47</th>
  <td class="line-code diff_in">
    <pre>      write_attribute(:others, h)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">48</th>
  <td class="line-code diff_in">
    <pre>      value
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">47</th>
  <th class="line-num">49</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">48</th>
  <th class="line-num">50</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">49</th>
  <th class="line-num">51</th>
  <td class="line-code ">
    <pre>  
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/views/repositories/_dir_list_content.rhtml
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">4</th>
  <th class="line-num">4</th>
  <td class="line-code ">
    <pre>&lt;tr id=&quot;&lt;%= tr_id %&gt;&quot; class=&quot;&lt;%= params[:parent_id] %&gt; entry &lt;%= entry.kind %&gt;&quot;&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre>&lt;td style=&quot;padding-left: &lt;%=18 * depth%&gt;px;&quot; class=&quot;filename&quot;&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>&lt;% if entry.is_dir? %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>&lt;span class=&quot;expander&quot; onclick=&quot;&lt;%=  remote_function :url =&gt; {:action =&gt; 'browse', :id =&gt; @project, :path =&gt; <span>entry.path</span>, :rev =&gt; @rev, :depth =&gt; (depth + 1), :parent_id =&gt; tr_id},
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>&lt;span class=&quot;expander&quot; onclick=&quot;&lt;%=  remote_function :url =&gt; {:action =&gt; 'browse', :id =&gt; @project, :path =&gt; <span>to_path_param(entry.path)</span>, :rev =&gt; @rev, :depth =&gt; (depth + 1), :parent_id =&gt; tr_id},
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num">8</th>
  <td class="line-code ">
    <pre>                  :update =&gt; { :success =&gt; tr_id },
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num">9</th>
  <td class="line-code ">
    <pre>                  :position =&gt; :after,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num">10</th>
  <td class="line-code ">
    <pre>                  :success =&gt; &quot;scmEntryLoaded('#{tr_id}')&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">11</th>
  <td class="line-code ">
    <pre>                  :condition =&gt; &quot;scmEntryClick('#{tr_id}')&quot;%&gt;&quot;&gt;&amp;nbsp&lt;/span&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num">12</th>
  <td class="line-code ">
    <pre>&lt;% end %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">13</th>
  <th class="line-num">13</th>
  <td class="line-code ">
    <pre>&lt;%=  link_to h(entry.name),
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">14</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          {:action =&gt; (entry.is_dir? ? 'browse' : 'changes'), :id =&gt; @project, :path =&gt; <span>entry.path</span>, :rev =&gt; @rev},
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">14</th>
  <td class="line-code diff_in">
    <pre>          {:action =&gt; (entry.is_dir? ? 'browse' : 'changes'), :id =&gt; @project, :path =&gt; <span>to_path_param(entry.path)</span>, :rev =&gt; @rev},
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">15</th>
  <th class="line-num">15</th>
  <td class="line-code ">
    <pre>          :class =&gt; (entry.is_dir? ? 'icon icon-folder' : 'icon icon-file')%&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">16</th>
  <th class="line-num">16</th>
  <td class="line-code ">
    <pre>&lt;/td&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">17</th>
  <th class="line-num">17</th>
  <td class="line-code ">
    <pre>&lt;td class=&quot;size&quot;&gt;&lt;%= (entry.size ? number_to_human_size(entry.size) : &quot;?&quot;) unless entry.is_dir? %&gt;&lt;/td&gt;
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/views/repositories/_navigation.rhtml
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">10</th>
  <th class="line-num">10</th>
  <td class="line-code ">
    <pre>    link_path &lt;&lt; '/' unless link_path.empty?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">11</th>
  <td class="line-code ">
    <pre>    link_path &lt;&lt; &quot;#{dir}&quot; 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num">12</th>
  <td class="line-code ">
    <pre>    %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">13</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    / &lt;%= link_to h(dir), :action =&gt; 'browse', :id =&gt; @project, :path =&gt; <span>link_path</span>, :rev =&gt; @rev %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">13</th>
  <td class="line-code diff_in">
    <pre>    / &lt;%= link_to h(dir), :action =&gt; 'browse', :id =&gt; @project, :path =&gt; <span>to_path_param(link_path)</span>, :rev =&gt; @rev %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">14</th>
  <th class="line-num">14</th>
  <td class="line-code ">
    <pre>&lt;% end %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">15</th>
  <th class="line-num">15</th>
  <td class="line-code ">
    <pre>&lt;% if filename %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">16</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    / &lt;%= link_to h(filename), :action =&gt; 'changes', :id =&gt; @project, :path =&gt; <span>&quot;#{link_path}/#{filename}&quot;</span>, :rev =&gt; @rev %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">16</th>
  <td class="line-code diff_in">
    <pre>    / &lt;%= link_to h(filename), :action =&gt; 'changes', :id =&gt; @project, :path =&gt; <span>to_path_param(&quot;#{link_path}/#{filename}&quot;)</span>, :rev =&gt; @rev %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">17</th>
  <th class="line-num">17</th>
  <td class="line-code ">
    <pre>&lt;% end %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">18</th>
  <th class="line-num">18</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">19</th>
  <th class="line-num">19</th>
  <td class="line-code ">
    <pre>&lt;%= &quot;@ #{revision}&quot; if revision %&gt;
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/views/repositories/_revisions.rhtml
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>&lt;% form_tag({:controller =&gt; 'repositories', :action =&gt; 'diff', :id =&gt; @project, :path =&gt; <span>path</span>}, :method =&gt; :get) do %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>&lt;% form_tag({:controller =&gt; 'repositories', :action =&gt; 'diff', :id =&gt; @project, :path =&gt; <span>to_path_param(path)</span>}, :method =&gt; :get) do %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num">2</th>
  <td class="line-code ">
    <pre>&lt;table class=&quot;list changesets&quot;&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num">3</th>
  <td class="line-code ">
    <pre>&lt;thead&gt;&lt;tr&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num">4</th>
  <td class="line-code ">
    <pre>&lt;th&gt;#&lt;/th&gt;
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/views/repositories/changes.rhtml
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">4</th>
  <th class="line-num">4</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre>&lt;p&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>&lt;% if @repository.supports_cat? %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    &lt;%= link_to l(:button_view), {:action =&gt; 'entry', :id =&gt; @project, :path =&gt; <span>@path</span>, :rev =&gt; @rev } %&gt; |
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>    &lt;%= link_to l(:button_view), {:action =&gt; 'entry', :id =&gt; @project, :path =&gt; <span>to_path_param(@path)</span>, :rev =&gt; @rev } %&gt; |
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num">8</th>
  <td class="line-code ">
    <pre>&lt;% end %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num">9</th>
  <td class="line-code ">
    <pre>&lt;% if @repository.supports_annotate? %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    &lt;%= link_to l(:button_annotate), {:action =&gt; 'annotate', :id =&gt; @project, :path =&gt; <span>@path</span>, :rev =&gt; @rev } %&gt; |
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">10</th>
  <td class="line-code diff_in">
    <pre>    &lt;%= link_to l(:button_annotate), {:action =&gt; 'annotate', :id =&gt; @project, :path =&gt; <span>to_path_param(@path)</span>, :rev =&gt; @rev } %&gt; |
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">11</th>
  <td class="line-code ">
    <pre>&lt;% end %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>&lt;%= link_to(l(:button_download), {:action =&gt; 'entry', :id =&gt; @project, :path =&gt; <span>@path</span>, :rev =&gt; @rev, :format =&gt; 'raw' }) if @repository.supports_cat? %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">12</th>
  <td class="line-code diff_in">
    <pre>&lt;%= link_to(l(:button_download), {:action =&gt; 'entry', :id =&gt; @project, :path =&gt; <span>to_path_param(@path)</span>, :rev =&gt; @rev, :format =&gt; 'raw' }) if @repository.supports_cat? %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">13</th>
  <th class="line-num">13</th>
  <td class="line-code ">
    <pre>&lt;%= &quot;(#{number_to_human_size(@entry.size)})&quot; if @entry.size %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">14</th>
  <th class="line-num">14</th>
  <td class="line-code ">
    <pre>&lt;/p&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">15</th>
  <th class="line-num">15</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/app/views/repositories/revision.rhtml
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">55</th>
  <th class="line-num">55</th>
  <td class="line-code ">
    <pre>&lt;%= &quot;(#{change.revision})&quot; unless change.revision.blank?  %&gt;&lt;/td&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">56</th>
  <th class="line-num">56</th>
  <td class="line-code ">
    <pre>&lt;td align=&quot;right&quot;&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">57</th>
  <th class="line-num">57</th>
  <td class="line-code ">
    <pre>&lt;% if change.action == &quot;M&quot; %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">58</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>&lt;%= link_to l(:label_view_diff), :action =&gt; 'diff', :id =&gt; @project, :path =&gt; <span>without_leading_slash</span>(change.relative_path), :rev =&gt; @changeset.revision %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">58</th>
  <td class="line-code diff_in">
    <pre>&lt;%= link_to l(:label_view_diff), :action =&gt; 'diff', :id =&gt; @project, :path =&gt; <span>to_path_param</span>(change.relative_path), :rev =&gt; @changeset.revision %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">59</th>
  <th class="line-num">59</th>
  <td class="line-code ">
    <pre>&lt;% end %&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">60</th>
  <th class="line-num">60</th>
  <td class="line-code ">
    <pre>&lt;/td&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">61</th>
  <th class="line-num">61</th>
  <td class="line-code ">
    <pre>&lt;/tr&gt;
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/config/boot.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre># Don't change this file. Configuration is done in config/environment.rb and config/environments/*.rb
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre># Don't change this file!
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre># Configure your app in config/environment.rb and config/environments/*.rb
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num">3</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>unless defined?(RAILS_ROOT)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  root_path = File.join(File.dirname(__FILE__), '..')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  unless RUBY_PLATFORM =~ /mswin32/
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    require 'pathname'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    root_path = Pathname.new(root_path).cleanpath(true).to_s
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>RAILS_ROOT = &quot;#{File.dirname(__FILE__)}/..&quot; unless defined?(RAILS_ROOT)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">5</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">6</th>
  <td class="line-code diff_in">
    <pre>module Rails
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>  class &lt;&lt; self
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">8</th>
  <td class="line-code diff_in">
    <pre>    def boot!
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">9</th>
  <td class="line-code diff_in">
    <pre>      unless booted?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">10</th>
  <td class="line-code diff_in">
    <pre>        preinitialize
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">11</th>
  <td class="line-code diff_in">
    <pre>        pick_boot.run
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">12</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">13</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">14</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">15</th>
  <td class="line-code diff_in">
    <pre>    def booted?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">16</th>
  <td class="line-code diff_in">
    <pre>      defined? Rails::Initializer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">17</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">18</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">19</th>
  <td class="line-code diff_in">
    <pre>    def pick_boot
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">20</th>
  <td class="line-code diff_in">
    <pre>      (vendor_rails? ? VendorBoot : GemBoot).new
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">21</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">22</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">23</th>
  <td class="line-code diff_in">
    <pre>    def vendor_rails?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">24</th>
  <td class="line-code diff_in">
    <pre>      File.exist?(&quot;#{RAILS_ROOT}/vendor/rails&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">25</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">26</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">27</th>
  <td class="line-code diff_in">
    <pre>    def preinitialize
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">28</th>
  <td class="line-code diff_in">
    <pre>      load(preinitializer_path) if File.exist?(preinitializer_path)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">29</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">30</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">31</th>
  <td class="line-code diff_in">
    <pre>    def preinitializer_path
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">32</th>
  <td class="line-code diff_in">
    <pre>      &quot;#{RAILS_ROOT}/config/preinitializer.rb&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">33</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num">34</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  RAILS_ROOT = root_path
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">35</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>if File.directory?(&quot;#{RAILS_ROOT}/vendor/rails&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">13</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  require &quot;#{RAILS_ROOT}/vendor/rails/railties/lib/initializer&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">14</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">15</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  require 'rubygems'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">16</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  require 'initializer'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">36</th>
  <td class="line-code diff_in">
    <pre>  class Boot
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">37</th>
  <td class="line-code diff_in">
    <pre>    def run
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">38</th>
  <td class="line-code diff_in">
    <pre>      load_initializer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">39</th>
  <td class="line-code diff_in">
    <pre>      Rails::Initializer.run(:set_load_path)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">40</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">41</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">42</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">43</th>
  <td class="line-code diff_in">
    <pre>  class VendorBoot &lt; Boot
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">44</th>
  <td class="line-code diff_in">
    <pre>    def load_initializer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">45</th>
  <td class="line-code diff_in">
    <pre>      require &quot;#{RAILS_ROOT}/vendor/rails/railties/lib/initializer&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">46</th>
  <td class="line-code diff_in">
    <pre>      Rails::Initializer.run(:install_gem_spec_stubs)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">47</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">48</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">49</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">50</th>
  <td class="line-code diff_in">
    <pre>  class GemBoot &lt; Boot
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">51</th>
  <td class="line-code diff_in">
    <pre>    def load_initializer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">52</th>
  <td class="line-code diff_in">
    <pre>      self.class.load_rubygems
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">53</th>
  <td class="line-code diff_in">
    <pre>      load_rails_gem
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">54</th>
  <td class="line-code diff_in">
    <pre>      require 'initializer'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">55</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">56</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">57</th>
  <td class="line-code diff_in">
    <pre>    def load_rails_gem
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">58</th>
  <td class="line-code diff_in">
    <pre>      if version = self.class.gem_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">59</th>
  <td class="line-code diff_in">
    <pre>        gem 'rails', version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">60</th>
  <td class="line-code diff_in">
    <pre>      else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">61</th>
  <td class="line-code diff_in">
    <pre>        gem 'rails'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">62</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">63</th>
  <td class="line-code diff_in">
    <pre>    rescue Gem::LoadError =&gt; load_error
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">64</th>
  <td class="line-code diff_in">
    <pre>      $stderr.puts %(Missing the Rails #{version} gem. Please `gem install -v=#{version} rails`, update your RAILS_GEM_VERSION setting in config/environment.rb for the Rails version you do have installed, or comment out RAILS_GEM_VERSION to use the latest version installed.)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">65</th>
  <td class="line-code diff_in">
    <pre>      exit 1
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">66</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">67</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">68</th>
  <td class="line-code diff_in">
    <pre>    class &lt;&lt; self
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">69</th>
  <td class="line-code diff_in">
    <pre>      def rubygems_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">70</th>
  <td class="line-code diff_in">
    <pre>        Gem::RubyGemsVersion if defined? Gem::RubyGemsVersion
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">71</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">72</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">73</th>
  <td class="line-code diff_in">
    <pre>      def gem_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">74</th>
  <td class="line-code diff_in">
    <pre>        if defined? RAILS_GEM_VERSION
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">75</th>
  <td class="line-code diff_in">
    <pre>          RAILS_GEM_VERSION
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">76</th>
  <td class="line-code diff_in">
    <pre>        elsif ENV.include?('RAILS_GEM_VERSION')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">77</th>
  <td class="line-code diff_in">
    <pre>          ENV['RAILS_GEM_VERSION']
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">78</th>
  <td class="line-code diff_in">
    <pre>        else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">79</th>
  <td class="line-code diff_in">
    <pre>          parse_gem_version(read_environment_rb)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">80</th>
  <td class="line-code diff_in">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">81</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">82</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">83</th>
  <td class="line-code diff_in">
    <pre>      def load_rubygems
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">84</th>
  <td class="line-code diff_in">
    <pre>        require 'rubygems'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">85</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">86</th>
  <td class="line-code diff_in">
    <pre>        unless rubygems_version &gt;= '0.9.4'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">87</th>
  <td class="line-code diff_in">
    <pre>          $stderr.puts %(Rails requires RubyGems &gt;= 0.9.4 (you have #{rubygems_version}). Please `gem update --system` and try again.)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">88</th>
  <td class="line-code diff_in">
    <pre>          exit 1
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">89</th>
  <td class="line-code diff_in">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">90</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">91</th>
  <td class="line-code diff_in">
    <pre>      rescue LoadError
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">92</th>
  <td class="line-code diff_in">
    <pre>        $stderr.puts %(Rails requires RubyGems &gt;= 0.9.4. Please install RubyGems and try again: http://rubygems.rubyforge.org)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">93</th>
  <td class="line-code diff_in">
    <pre>        exit 1
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">94</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">95</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">96</th>
  <td class="line-code diff_in">
    <pre>      def parse_gem_version(text)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">97</th>
  <td class="line-code diff_in">
    <pre>        $1 if text =~ /^[^#]*RAILS_GEM_VERSION\s*=\s*[&quot;']([!~&lt;&gt;=]*\s*[\d.]+)[&quot;']/
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">98</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">99</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">100</th>
  <td class="line-code diff_in">
    <pre>      private
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">101</th>
  <td class="line-code diff_in">
    <pre>        def read_environment_rb
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">102</th>
  <td class="line-code diff_in">
    <pre>          File.read(&quot;#{RAILS_ROOT}/config/environment.rb&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">103</th>
  <td class="line-code diff_in">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">104</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">105</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">17</th>
  <th class="line-num">106</th>
  <td class="line-code ">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">18</th>
  <th class="line-num">107</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">19</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Rails::Initializer.run(:set_load_path)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">108</th>
  <td class="line-code diff_in">
    <pre># All that for this:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">109</th>
  <td class="line-code diff_in">
    <pre>Rails.boot!
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/config/environment.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre># ENV['RAILS_ENV'] ||= 'production'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num">7</th>
  <td class="line-code ">
    <pre># Specifies gem version of Rails to use when vendor/rails is not present
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>RAILS_GEM_VERSION = '2.<span>0.2</span>' unless defined? RAILS_GEM_VERSION
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">8</th>
  <td class="line-code diff_in">
    <pre>RAILS_GEM_VERSION = '2.<span>1.0</span>' unless defined? RAILS_GEM_VERSION
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num">9</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num">10</th>
  <td class="line-code ">
    <pre># Bootstrap the Rails environment, frameworks, and default configuration
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">11</th>
  <td class="line-code ">
    <pre>require File.join(File.dirname(__FILE__), 'boot')
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">71</th>
  <th class="line-num">71</th>
  <td class="line-code ">
    <pre>	config.action_mailer.delivery_method = :smtp  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">72</th>
  <th class="line-num">72</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">73</th>
  <th class="line-num">73</th>
  <td class="line-code ">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">74</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">75</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>ActiveRecord::Errors.default_error_messages = {
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">76</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :inclusion =&gt; &quot;activerecord_error_inclusion&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">77</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :exclusion =&gt; &quot;activerecord_error_exclusion&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">78</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :invalid =&gt; &quot;activerecord_error_invalid&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">79</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :confirmation =&gt; &quot;activerecord_error_confirmation&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">80</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :accepted  =&gt; &quot;activerecord_error_accepted&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">81</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :empty =&gt; &quot;activerecord_error_empty&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">82</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :blank =&gt; &quot;activerecord_error_blank&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">83</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :too_long =&gt; &quot;activerecord_error_too_long&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">84</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :too_short =&gt; &quot;activerecord_error_too_short&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">85</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :wrong_length =&gt; &quot;activerecord_error_wrong_length&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">86</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :taken =&gt; &quot;activerecord_error_taken&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">87</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  :not_a_number =&gt; &quot;activerecord_error_not_a_number&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">88</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">89</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">90</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>ActionView::Base.field_error_proc = Proc.new{ |html_tag, instance| &quot;#{html_tag}&quot; }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">91</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">92</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Mime::SET &lt;&lt; Mime::CSV unless Mime::SET.include?(Mime::CSV)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">93</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Mime::Type.register 'application/pdf', :pdf
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">94</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">95</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>GLoc.set_config :default_language =&gt; :en
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">96</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>GLoc.clear_strings
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">97</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>GLoc.set_kcode
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">98</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>GLoc.load_localized_strings
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">99</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>GLoc.set_config(:raise_string_not_found_errors =&gt; false)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">100</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">101</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'redmine'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">102</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/config/initializers/10-patches.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>ActiveRecord::Errors.default_error_messages = {
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>  :inclusion =&gt; &quot;activerecord_error_inclusion&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>  :exclusion =&gt; &quot;activerecord_error_exclusion&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">5</th>
  <td class="line-code diff_in">
    <pre>  :invalid =&gt; &quot;activerecord_error_invalid&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">6</th>
  <td class="line-code diff_in">
    <pre>  :confirmation =&gt; &quot;activerecord_error_confirmation&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>  :accepted  =&gt; &quot;activerecord_error_accepted&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">8</th>
  <td class="line-code diff_in">
    <pre>  :empty =&gt; &quot;activerecord_error_empty&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">9</th>
  <td class="line-code diff_in">
    <pre>  :blank =&gt; &quot;activerecord_error_blank&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">10</th>
  <td class="line-code diff_in">
    <pre>  :too_long =&gt; &quot;activerecord_error_too_long&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">11</th>
  <td class="line-code diff_in">
    <pre>  :too_short =&gt; &quot;activerecord_error_too_short&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">12</th>
  <td class="line-code diff_in">
    <pre>  :wrong_length =&gt; &quot;activerecord_error_wrong_length&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">13</th>
  <td class="line-code diff_in">
    <pre>  :taken =&gt; &quot;activerecord_error_taken&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">14</th>
  <td class="line-code diff_in">
    <pre>  :not_a_number =&gt; &quot;activerecord_error_not_a_number&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">15</th>
  <td class="line-code diff_in">
    <pre>}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">16</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">17</th>
  <td class="line-code diff_in">
    <pre>ActionView::Base.field_error_proc = Proc.new{ |html_tag, instance| &quot;#{html_tag}&quot; }
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/config/initializers/20-mime_types.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre># Add new mime types for use in respond_to blocks:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>Mime::SET &lt;&lt; Mime::CSV unless Mime::SET.include?(Mime::CSV)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>Mime::Type.register 'application/pdf', :pdf
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/config/initializers/30-redmine.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>GLoc.set_config :default_language =&gt; :en
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>GLoc.clear_strings
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>GLoc.set_kcode
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>GLoc.load_localized_strings
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">5</th>
  <td class="line-code diff_in">
    <pre>GLoc.set_config(:raise_string_not_found_errors =&gt; false)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">6</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>require 'redmine'
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/db/migrate/072_add_enumerations_position.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num">1</th>
  <td class="line-code ">
    <pre>class AddEnumerationsPosition &lt; ActiveRecord::Migration
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num">2</th>
  <td class="line-code ">
    <pre>  def self.up
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num">3</th>
  <td class="line-code ">
    <pre>    add_column(:enumerations, :position, :integer, :default =&gt; 1) unless Enumeration.column_names.include?('position')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    Enumeration.find(:all).group_by(&amp;:opt).each<span>_value  do |</span>enums|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>    Enumeration.find(:all).group_by(&amp;:opt).each<span> do |opt, </span>enums|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre>      enums.each_with_index do |enum, i|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>        # do not call model callbacks
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num">7</th>
  <td class="line-code ">
    <pre>        Enumeration.update_all &quot;position = #{i+1}&quot;, {:id =&gt; enum.id}
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/db/migrate/078_add_custom_fields_position.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num">1</th>
  <td class="line-code ">
    <pre>class AddCustomFieldsPosition &lt; ActiveRecord::Migration
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num">2</th>
  <td class="line-code ">
    <pre>  def self.up
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num">3</th>
  <td class="line-code ">
    <pre>    add_column(:custom_fields, :position, :integer, :default =&gt; 1)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    CustomField.find(:all).group_by(&amp;:type).each<span>_value  do |</span>fields|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>    CustomField.find(:all).group_by(&amp;:type).each<span>  do |t, </span>fields|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre>      fields.each_with_index do |field, i|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>        # do not call model callbacks
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num">7</th>
  <td class="line-code ">
    <pre>        CustomField.update_all &quot;position = #{i+1}&quot;, {:id =&gt; field.id}
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/lib/tabular_form_builder.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">22</th>
  <td class="line-code ">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">23</th>
  <td class="line-code ">
    <pre>  def initialize(object_name, object, template, options, proc)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">24</th>
  <td class="line-code ">
    <pre>    set_language_if_valid options.delete(:lang)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    <span>@object_name, @object, @template, @options, @proc = object_name, object, template, options, proc        </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">25</th>
  <td class="line-code diff_in">
    <pre>    <span>super</span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>  end      
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>      
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>  (field_helpers - %w(radio_button hidden_field) + %w(date_select)).each do |selector|
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/script/dbconsole
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>#!/usr/bin/env ruby
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>require File.dirname(__FILE__) + '/../config/boot'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>require 'commands/dbconsole'
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/script/performance/request
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>#!/usr/bin/env ruby
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>require File.dirname(__FILE__) + '/../../config/boot'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>require 'commands/performance/request'
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/script/process/inspector
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>#!/usr/bin/env ruby
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>require File.dirname(__FILE__) + '/../../config/boot'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>require 'commands/process/inspector'
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/test/functional/projects_controller_test.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">38</th>
  <th class="line-num">38</th>
  <td class="line-code ">
    <pre>    assert_template 'index'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">39</th>
  <th class="line-num">39</th>
  <td class="line-code ">
    <pre>    assert_not_nil assigns(:project_tree)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">40</th>
  <th class="line-num">40</th>
  <td class="line-code ">
    <pre>    # Root project as hash key
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">41</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert assigns(:project_tree).<span>has_key</span>?(Project.find(1))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">41</th>
  <td class="line-code diff_in">
    <pre>    assert assigns(:project_tree).<span>keys.include</span>?(Project.find(1))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">42</th>
  <th class="line-num">42</th>
  <td class="line-code ">
    <pre>    # Subproject in corresponding value
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">43</th>
  <th class="line-num">43</th>
  <td class="line-code ">
    <pre>    assert assigns(:project_tree)[Project.find(1)].include?(Project.find(3))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">44</th>
  <th class="line-num">44</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/test/integration/issues_test.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">20</th>
  <th class="line-num">20</th>
  <td class="line-code ">
    <pre>class IssuesTest &lt; ActionController::IntegrationTest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">21</th>
  <th class="line-num">21</th>
  <td class="line-code ">
    <pre>  fixtures :projects, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">22</th>
  <td class="line-code ">
    <pre>           :users,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">23</th>
  <td class="line-code diff_in">
    <pre>           :roles,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">24</th>
  <td class="line-code diff_in">
    <pre>           :members,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">25</th>
  <td class="line-code ">
    <pre>           :trackers,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>           :projects_trackers,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">27</th>
  <td class="line-code diff_in">
    <pre>           :enabled_modules,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>           :issue_statuses,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">29</th>
  <td class="line-code ">
    <pre>           :issues,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>           :enumerations,
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/test/test_helper.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">65</th>
  <th class="line-num">65</th>
  <td class="line-code ">
    <pre>    Attachment.storage_path = &quot;#{RAILS_ROOT}/tmp/test/attachments&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">66</th>
  <th class="line-num">66</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">67</th>
  <th class="line-num">67</th>
  <td class="line-code ">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">68</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">69</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">70</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre># ActionController::TestUploadedFile bug
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">71</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre># see http://dev.rubyonrails.org/ticket/4635
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">72</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>class String
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">73</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def original_filename
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">74</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    &quot;testfile.txt&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">75</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">76</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">77</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def content_type
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">78</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    &quot;text/plain&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">79</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">80</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">81</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def read
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">82</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    self.to_s
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">83</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">84</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/test/unit/role_test.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>    target = Role.new(:name =&gt; 'Target')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>    assert target.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">29</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    <span>assert </span>target.workflows.copy(source)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">29</th>
  <td class="line-code diff_in">
    <pre>    <span></span>target.workflows.copy(source)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">30</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>    target.reload
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">31</th>
  <th class="line-num">31</th>
  <td class="line-code ">
    <pre>    assert_equal 90, target.workflows.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">32</th>
  <th class="line-num">32</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/test/unit/tracker_test.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>    target = Tracker.new(:name =&gt; 'Target')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>    assert target.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">29</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    <span>assert </span>target.workflows.copy(source)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">29</th>
  <td class="line-code diff_in">
    <pre>    <span></span>target.workflows.copy(source)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">30</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>    target.reload
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">31</th>
  <th class="line-num">31</th>
  <td class="line-code ">
    <pre>    assert_equal 89, target.workflows.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">32</th>
  <th class="line-num">32</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/Rakefile
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'rubygems'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Gem::manage_gems<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'rake/rdoctask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'rake/packagetask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'rake/gempackagetask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'rake/testtask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'rake/contrib/rubyforgepublisher'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>PKG_NAME           = 'acts_as_versioned'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>PKG_VERSION        = '0.3.1'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">13</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>PKG_FILE_NAME      = &quot;#{PKG_NAME}-#{PKG_VERSION}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">14</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>PROD_HOST          = &quot;technoweenie@bidwell.textdrive.com&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">15</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>RUBY_FORGE_PROJECT = 'ar-versioned'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">16</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>RUBY_FORGE_USER    = 'technoweenie'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">17</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">18</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>desc 'Default: run unit tests.'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">19</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>task :default =&gt; :test<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">20</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">21</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>desc 'Test the calculations plugin.'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">22</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Rake::TestTask.new(:test) do |t|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  t.libs &lt;&lt; 'lib'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  t.pattern = 'test/**/*_test.rb'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  t.verbose = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>desc 'Generate documentation for the calculations plugin.'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">29</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Rake::RDocTask.new(:rdoc) do |rdoc|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">30</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  rdoc.rdoc_dir = 'rdoc'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">31</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  rdoc.title    = &quot;#{PKG_NAME} -- Simple versioning with active record models&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">32</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  rdoc.options &lt;&lt; '--line-numbers --inline-source'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">33</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  rdoc.rdoc_files.include('README', 'CHANGELOG', 'RUNNING_UNIT_TESTS')<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">34</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  rdoc.rdoc_files.include('lib/**/*.rb')<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">35</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">36</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">37</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>spec = Gem::Specification.new do |s|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">38</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.name            = PKG_NAME<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">39</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.version         = PKG_VERSION<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">40</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.platform        = Gem::Platform::RUBY<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">41</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.summary         = &quot;Simple versioning with active record models&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">42</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.files           = FileList[&quot;{lib,test}/**/*&quot;].to_a + %w(README MIT-LICENSE CHANGELOG RUNNING_UNIT_TESTS)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">43</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.files.delete      &quot;acts_as_versioned_plugin.sqlite.db&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">44</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.files.delete      &quot;acts_as_versioned_plugin.sqlite3.db&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">45</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.files.delete      &quot;test/debug.log&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">46</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.require_path    = 'lib'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">47</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.autorequire     = 'acts_as_versioned'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">48</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.has_rdoc        = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">49</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.test_files      = Dir['test/**/*_test.rb']<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">50</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.add_dependency    'activerecord', '&gt;= 1.10.1'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">51</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.add_dependency    'activesupport', '&gt;= 1.1.1'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">52</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.author          = &quot;Rick Olson&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">53</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.email           = &quot;technoweenie@gmail.com&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">54</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  s.homepage        = &quot;http://techno-weenie.net&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">55</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">56</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">57</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>Rake::GemPackageTask.new(spec) do |pkg|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">58</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  pkg.need_tar = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">59</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">60</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">61</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>desc &quot;Publish the API documentation&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">62</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>task :pdoc =&gt; [:rdoc] do<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">63</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  Rake::RubyForgePublisher.new(RUBY_FORGE_PROJECT, RUBY_FORGE_USER).upload<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">64</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">65</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">66</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>desc 'Publish the gem and API docs'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">67</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>task :publish =&gt; [:pdoc, :rubyforge_upload]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">68</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">69</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>desc &quot;Publish the release files to RubyForge.&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">70</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>task :rubyforge_upload =&gt; :package do<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">71</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  files = %w(gem tgz).map { |ext| &quot;pkg/#{PKG_FILE_NAME}.#{ext}&quot; }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">72</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">73</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  if RUBY_FORGE_PROJECT then<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">74</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    require 'net/http'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">75</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    require 'open-uri'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">76</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">77</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    project_uri = &quot;http://rubyforge.org/projects/#{RUBY_FORGE_PROJECT}/&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">78</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    project_data = open(project_uri) { |data| data.read }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">79</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    group_id = project_data[/[?&amp;]group_id=(\d+)/, 1]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">80</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    raise &quot;Couldn't get group id&quot; unless group_id<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">81</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">82</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    # This echos password to shell which is a bit sucky<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">83</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    if ENV[&quot;RUBY_FORGE_PASSWORD&quot;]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">84</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      password = ENV[&quot;RUBY_FORGE_PASSWORD&quot;]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">85</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    else<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">86</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      print &quot;#{RUBY_FORGE_USER}@rubyforge.org's password: &quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">87</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      password = STDIN.gets.chomp<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">88</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">89</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">90</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    login_response = Net::HTTP.start(&quot;rubyforge.org&quot;, 80) do |http|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">91</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      data = [<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">92</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        &quot;login=1&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">93</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        &quot;form_loginname=#{RUBY_FORGE_USER}&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">94</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        &quot;form_pw=#{password}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">95</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      ].join(&quot;&amp;&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">96</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      http.post(&quot;/account/login.php&quot;, data)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">97</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">98</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">99</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    cookie = login_response[&quot;set-cookie&quot;]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">100</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    raise &quot;Login failed&quot; unless cookie<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">101</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    headers = { &quot;Cookie&quot; =&gt; cookie }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">102</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">103</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    release_uri = &quot;http://rubyforge.org/frs/admin/?group_id=#{group_id}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">104</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    release_data = open(release_uri, headers) { |data| data.read }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">105</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    package_id = release_data[/[?&amp;]package_id=(\d+)/, 1]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">106</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    raise &quot;Couldn't get package id&quot; unless package_id<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">107</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">108</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    first_file = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">109</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    release_id = &quot;&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">110</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">111</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    files.each do |filename|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">112</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      basename  = File.basename(filename)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">113</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      file_ext  = File.extname(filename)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">114</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      file_data = File.open(filename, &quot;rb&quot;) { |file| file.read }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">115</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">116</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      puts &quot;Releasing #{basename}...&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">117</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">118</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      release_response = Net::HTTP.start(&quot;rubyforge.org&quot;, 80) do |http|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">119</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        release_date = Time.now.strftime(&quot;%Y-%m-%d %H:%M&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">120</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        type_map = {<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">121</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;.zip&quot;    =&gt; &quot;3000&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">122</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;.tgz&quot;    =&gt; &quot;3110&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">123</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;.gz&quot;     =&gt; &quot;3110&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">124</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;.gem&quot;    =&gt; &quot;1400&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">125</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        }; type_map.default = &quot;9999&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">126</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        type = type_map[file_ext]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">127</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        boundary = &quot;rubyqMY6QN9bp6e4kS21H4y0zxcvoor&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">128</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">129</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        query_hash = if first_file then<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">130</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          {<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">131</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;group_id&quot; =&gt; group_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">132</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;package_id&quot; =&gt; package_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">133</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;release_name&quot; =&gt; PKG_FILE_NAME,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">134</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;release_date&quot; =&gt; release_date,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">135</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;type_id&quot; =&gt; type,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">136</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;processor_id&quot; =&gt; &quot;8000&quot;, # Any<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">137</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;release_notes&quot; =&gt; &quot;&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">138</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;release_changes&quot; =&gt; &quot;&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">139</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;preformatted&quot; =&gt; &quot;1&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">140</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;submit&quot; =&gt; &quot;1&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">141</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">142</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        else<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">143</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          {<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">144</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;group_id&quot; =&gt; group_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">145</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;release_id&quot; =&gt; release_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">146</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;package_id&quot; =&gt; package_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">147</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;step2&quot; =&gt; &quot;1&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">148</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;type_id&quot; =&gt; type,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">149</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;processor_id&quot; =&gt; &quot;8000&quot;, # Any<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">150</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            &quot;submit&quot; =&gt; &quot;Add This File&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">151</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">152</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">153</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">154</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        query = &quot;?&quot; + query_hash.map do |(name, value)|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">155</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          [name, URI.encode(value)].join(&quot;=&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">156</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        end.join(&quot;&amp;&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">157</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">158</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        data = [<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">159</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;--&quot; + boundary,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">160</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;Content-Disposition: form-data; name=\&quot;userfile\&quot;; filename=\&quot;#{basename}\&quot;&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">161</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;Content-Type: application/octet-stream&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">162</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;Content-Transfer-Encoding: binary&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">163</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;&quot;, file_data, &quot;&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">164</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          ].join(&quot;\x0D\x0A&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">165</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">166</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        release_headers = headers.merge(<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">167</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          &quot;Content-Type&quot; =&gt; &quot;multipart/form-data; boundary=#{boundary}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">168</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        )<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">169</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">170</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        target = first_file ? &quot;/frs/admin/qrs.php&quot; : &quot;/frs/admin/editrelease.php&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">171</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        http.post(target + query, data, release_headers)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">172</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">173</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">174</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      if first_file then<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">175</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        release_id = release_response.body[/release_id=(\d+)/, 1]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">176</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        raise(&quot;Couldn't get release id&quot;) unless release_id<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">177</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">178</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">179</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      first_file = false<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">180</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">181</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>require 'rubygems'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>Gem::manage_gems<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">5</th>
  <td class="line-code diff_in">
    <pre>require 'rake/rdoctask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">6</th>
  <td class="line-code diff_in">
    <pre>require 'rake/packagetask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>require 'rake/gempackagetask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">8</th>
  <td class="line-code diff_in">
    <pre>require 'rake/testtask'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">9</th>
  <td class="line-code diff_in">
    <pre>require 'rake/contrib/rubyforgepublisher'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">10</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">11</th>
  <td class="line-code diff_in">
    <pre>PKG_NAME           = 'acts_as_versioned'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">12</th>
  <td class="line-code diff_in">
    <pre>PKG_VERSION        = '0.3.1'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">13</th>
  <td class="line-code diff_in">
    <pre>PKG_FILE_NAME      = &quot;#{PKG_NAME}-#{PKG_VERSION}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">14</th>
  <td class="line-code diff_in">
    <pre>PROD_HOST          = &quot;technoweenie@bidwell.textdrive.com&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">15</th>
  <td class="line-code diff_in">
    <pre>RUBY_FORGE_PROJECT = 'ar-versioned'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">16</th>
  <td class="line-code diff_in">
    <pre>RUBY_FORGE_USER    = 'technoweenie'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">17</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">18</th>
  <td class="line-code diff_in">
    <pre>desc 'Default: run unit tests.'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">19</th>
  <td class="line-code diff_in">
    <pre>task :default =&gt; :test<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">20</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">21</th>
  <td class="line-code diff_in">
    <pre>desc 'Test the calculations plugin.'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">22</th>
  <td class="line-code diff_in">
    <pre>Rake::TestTask.new(:test) do |t|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">23</th>
  <td class="line-code diff_in">
    <pre>  t.libs &lt;&lt; 'lib'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">24</th>
  <td class="line-code diff_in">
    <pre>  t.pattern = 'test/**/*_test.rb'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">25</th>
  <td class="line-code diff_in">
    <pre>  t.verbose = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">26</th>
  <td class="line-code diff_in">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">27</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">28</th>
  <td class="line-code diff_in">
    <pre>desc 'Generate documentation for the calculations plugin.'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">29</th>
  <td class="line-code diff_in">
    <pre>Rake::RDocTask.new(:rdoc) do |rdoc|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">30</th>
  <td class="line-code diff_in">
    <pre>  rdoc.rdoc_dir = 'rdoc'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">31</th>
  <td class="line-code diff_in">
    <pre>  rdoc.title    = &quot;#{PKG_NAME} -- Simple versioning with active record models&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">32</th>
  <td class="line-code diff_in">
    <pre>  rdoc.options &lt;&lt; '--line-numbers --inline-source'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">33</th>
  <td class="line-code diff_in">
    <pre>  rdoc.rdoc_files.include('README', 'CHANGELOG', 'RUNNING_UNIT_TESTS')<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">34</th>
  <td class="line-code diff_in">
    <pre>  rdoc.rdoc_files.include('lib/**/*.rb')<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">35</th>
  <td class="line-code diff_in">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">36</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">37</th>
  <td class="line-code diff_in">
    <pre>spec = Gem::Specification.new do |s|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">38</th>
  <td class="line-code diff_in">
    <pre>  s.name            = PKG_NAME<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">39</th>
  <td class="line-code diff_in">
    <pre>  s.version         = PKG_VERSION<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">40</th>
  <td class="line-code diff_in">
    <pre>  s.platform        = Gem::Platform::RUBY<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">41</th>
  <td class="line-code diff_in">
    <pre>  s.summary         = &quot;Simple versioning with active record models&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">42</th>
  <td class="line-code diff_in">
    <pre>  s.files           = FileList[&quot;{lib,test}/**/*&quot;].to_a + %w(README MIT-LICENSE CHANGELOG RUNNING_UNIT_TESTS)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">43</th>
  <td class="line-code diff_in">
    <pre>  s.files.delete      &quot;acts_as_versioned_plugin.sqlite.db&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">44</th>
  <td class="line-code diff_in">
    <pre>  s.files.delete      &quot;acts_as_versioned_plugin.sqlite3.db&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">45</th>
  <td class="line-code diff_in">
    <pre>  s.files.delete      &quot;test/debug.log&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">46</th>
  <td class="line-code diff_in">
    <pre>  s.require_path    = 'lib'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">47</th>
  <td class="line-code diff_in">
    <pre>  s.autorequire     = 'acts_as_versioned'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">48</th>
  <td class="line-code diff_in">
    <pre>  s.has_rdoc        = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">49</th>
  <td class="line-code diff_in">
    <pre>  s.test_files      = Dir['test/**/*_test.rb']<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">50</th>
  <td class="line-code diff_in">
    <pre>  s.add_dependency    'activerecord', '&gt;= 1.10.1'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">51</th>
  <td class="line-code diff_in">
    <pre>  s.add_dependency    'activesupport', '&gt;= 1.1.1'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">52</th>
  <td class="line-code diff_in">
    <pre>  s.author          = &quot;Rick Olson&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">53</th>
  <td class="line-code diff_in">
    <pre>  s.email           = &quot;technoweenie@gmail.com&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">54</th>
  <td class="line-code diff_in">
    <pre>  s.homepage        = &quot;http://techno-weenie.net&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">55</th>
  <td class="line-code diff_in">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">56</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">57</th>
  <td class="line-code diff_in">
    <pre>Rake::GemPackageTask.new(spec) do |pkg|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">58</th>
  <td class="line-code diff_in">
    <pre>  pkg.need_tar = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">59</th>
  <td class="line-code diff_in">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">60</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">61</th>
  <td class="line-code diff_in">
    <pre>desc &quot;Publish the API documentation&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">62</th>
  <td class="line-code diff_in">
    <pre>task :pdoc =&gt; [:rdoc] do<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">63</th>
  <td class="line-code diff_in">
    <pre>  Rake::RubyForgePublisher.new(RUBY_FORGE_PROJECT, RUBY_FORGE_USER).upload<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">64</th>
  <td class="line-code diff_in">
    <pre>end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">65</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">66</th>
  <td class="line-code diff_in">
    <pre>desc 'Publish the gem and API docs'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">67</th>
  <td class="line-code diff_in">
    <pre>task :publish =&gt; [:pdoc, :rubyforge_upload]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">68</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">69</th>
  <td class="line-code diff_in">
    <pre>desc &quot;Publish the release files to RubyForge.&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">70</th>
  <td class="line-code diff_in">
    <pre>task :rubyforge_upload =&gt; :package do<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">71</th>
  <td class="line-code diff_in">
    <pre>  files = %w(gem tgz).map { |ext| &quot;pkg/#{PKG_FILE_NAME}.#{ext}&quot; }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">72</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">73</th>
  <td class="line-code diff_in">
    <pre>  if RUBY_FORGE_PROJECT then<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">74</th>
  <td class="line-code diff_in">
    <pre>    require 'net/http'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">75</th>
  <td class="line-code diff_in">
    <pre>    require 'open-uri'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">76</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">77</th>
  <td class="line-code diff_in">
    <pre>    project_uri = &quot;http://rubyforge.org/projects/#{RUBY_FORGE_PROJECT}/&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">78</th>
  <td class="line-code diff_in">
    <pre>    project_data = open(project_uri) { |data| data.read }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">79</th>
  <td class="line-code diff_in">
    <pre>    group_id = project_data[/[?&amp;]group_id=(\d+)/, 1]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">80</th>
  <td class="line-code diff_in">
    <pre>    raise &quot;Couldn't get group id&quot; unless group_id<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">81</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">82</th>
  <td class="line-code diff_in">
    <pre>    # This echos password to shell which is a bit sucky<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">83</th>
  <td class="line-code diff_in">
    <pre>    if ENV[&quot;RUBY_FORGE_PASSWORD&quot;]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">84</th>
  <td class="line-code diff_in">
    <pre>      password = ENV[&quot;RUBY_FORGE_PASSWORD&quot;]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">85</th>
  <td class="line-code diff_in">
    <pre>    else<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">86</th>
  <td class="line-code diff_in">
    <pre>      print &quot;#{RUBY_FORGE_USER}@rubyforge.org's password: &quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">87</th>
  <td class="line-code diff_in">
    <pre>      password = STDIN.gets.chomp<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">88</th>
  <td class="line-code diff_in">
    <pre>    end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">89</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">90</th>
  <td class="line-code diff_in">
    <pre>    login_response = Net::HTTP.start(&quot;rubyforge.org&quot;, 80) do |http|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">91</th>
  <td class="line-code diff_in">
    <pre>      data = [<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">92</th>
  <td class="line-code diff_in">
    <pre>        &quot;login=1&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">93</th>
  <td class="line-code diff_in">
    <pre>        &quot;form_loginname=#{RUBY_FORGE_USER}&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">94</th>
  <td class="line-code diff_in">
    <pre>        &quot;form_pw=#{password}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">95</th>
  <td class="line-code diff_in">
    <pre>      ].join(&quot;&amp;&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">96</th>
  <td class="line-code diff_in">
    <pre>      http.post(&quot;/account/login.php&quot;, data)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">97</th>
  <td class="line-code diff_in">
    <pre>    end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">98</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">99</th>
  <td class="line-code diff_in">
    <pre>    cookie = login_response[&quot;set-cookie&quot;]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">100</th>
  <td class="line-code diff_in">
    <pre>    raise &quot;Login failed&quot; unless cookie<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">101</th>
  <td class="line-code diff_in">
    <pre>    headers = { &quot;Cookie&quot; =&gt; cookie }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">102</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">103</th>
  <td class="line-code diff_in">
    <pre>    release_uri = &quot;http://rubyforge.org/frs/admin/?group_id=#{group_id}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">104</th>
  <td class="line-code diff_in">
    <pre>    release_data = open(release_uri, headers) { |data| data.read }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">105</th>
  <td class="line-code diff_in">
    <pre>    package_id = release_data[/[?&amp;]package_id=(\d+)/, 1]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">106</th>
  <td class="line-code diff_in">
    <pre>    raise &quot;Couldn't get package id&quot; unless package_id<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">107</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">108</th>
  <td class="line-code diff_in">
    <pre>    first_file = true<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">109</th>
  <td class="line-code diff_in">
    <pre>    release_id = &quot;&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">110</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">111</th>
  <td class="line-code diff_in">
    <pre>    files.each do |filename|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">112</th>
  <td class="line-code diff_in">
    <pre>      basename  = File.basename(filename)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">113</th>
  <td class="line-code diff_in">
    <pre>      file_ext  = File.extname(filename)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">114</th>
  <td class="line-code diff_in">
    <pre>      file_data = File.open(filename, &quot;rb&quot;) { |file| file.read }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">115</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">116</th>
  <td class="line-code diff_in">
    <pre>      puts &quot;Releasing #{basename}...&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">117</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">118</th>
  <td class="line-code diff_in">
    <pre>      release_response = Net::HTTP.start(&quot;rubyforge.org&quot;, 80) do |http|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">119</th>
  <td class="line-code diff_in">
    <pre>        release_date = Time.now.strftime(&quot;%Y-%m-%d %H:%M&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">120</th>
  <td class="line-code diff_in">
    <pre>        type_map = {<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">121</th>
  <td class="line-code diff_in">
    <pre>          &quot;.zip&quot;    =&gt; &quot;3000&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">122</th>
  <td class="line-code diff_in">
    <pre>          &quot;.tgz&quot;    =&gt; &quot;3110&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">123</th>
  <td class="line-code diff_in">
    <pre>          &quot;.gz&quot;     =&gt; &quot;3110&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">124</th>
  <td class="line-code diff_in">
    <pre>          &quot;.gem&quot;    =&gt; &quot;1400&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">125</th>
  <td class="line-code diff_in">
    <pre>        }; type_map.default = &quot;9999&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">126</th>
  <td class="line-code diff_in">
    <pre>        type = type_map[file_ext]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">127</th>
  <td class="line-code diff_in">
    <pre>        boundary = &quot;rubyqMY6QN9bp6e4kS21H4y0zxcvoor&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">128</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">129</th>
  <td class="line-code diff_in">
    <pre>        query_hash = if first_file then<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">130</th>
  <td class="line-code diff_in">
    <pre>          {<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">131</th>
  <td class="line-code diff_in">
    <pre>            &quot;group_id&quot; =&gt; group_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">132</th>
  <td class="line-code diff_in">
    <pre>            &quot;package_id&quot; =&gt; package_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">133</th>
  <td class="line-code diff_in">
    <pre>            &quot;release_name&quot; =&gt; PKG_FILE_NAME,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">134</th>
  <td class="line-code diff_in">
    <pre>            &quot;release_date&quot; =&gt; release_date,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">135</th>
  <td class="line-code diff_in">
    <pre>            &quot;type_id&quot; =&gt; type,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">136</th>
  <td class="line-code diff_in">
    <pre>            &quot;processor_id&quot; =&gt; &quot;8000&quot;, # Any<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">137</th>
  <td class="line-code diff_in">
    <pre>            &quot;release_notes&quot; =&gt; &quot;&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">138</th>
  <td class="line-code diff_in">
    <pre>            &quot;release_changes&quot; =&gt; &quot;&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">139</th>
  <td class="line-code diff_in">
    <pre>            &quot;preformatted&quot; =&gt; &quot;1&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">140</th>
  <td class="line-code diff_in">
    <pre>            &quot;submit&quot; =&gt; &quot;1&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">141</th>
  <td class="line-code diff_in">
    <pre>          }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">142</th>
  <td class="line-code diff_in">
    <pre>        else<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">143</th>
  <td class="line-code diff_in">
    <pre>          {<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">144</th>
  <td class="line-code diff_in">
    <pre>            &quot;group_id&quot; =&gt; group_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">145</th>
  <td class="line-code diff_in">
    <pre>            &quot;release_id&quot; =&gt; release_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">146</th>
  <td class="line-code diff_in">
    <pre>            &quot;package_id&quot; =&gt; package_id,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">147</th>
  <td class="line-code diff_in">
    <pre>            &quot;step2&quot; =&gt; &quot;1&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">148</th>
  <td class="line-code diff_in">
    <pre>            &quot;type_id&quot; =&gt; type,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">149</th>
  <td class="line-code diff_in">
    <pre>            &quot;processor_id&quot; =&gt; &quot;8000&quot;, # Any<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">150</th>
  <td class="line-code diff_in">
    <pre>            &quot;submit&quot; =&gt; &quot;Add This File&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">151</th>
  <td class="line-code diff_in">
    <pre>          }<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">152</th>
  <td class="line-code diff_in">
    <pre>        end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">153</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">154</th>
  <td class="line-code diff_in">
    <pre>        query = &quot;?&quot; + query_hash.map do |(name, value)|<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">155</th>
  <td class="line-code diff_in">
    <pre>          [name, URI.encode(value)].join(&quot;=&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">156</th>
  <td class="line-code diff_in">
    <pre>        end.join(&quot;&amp;&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">157</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">158</th>
  <td class="line-code diff_in">
    <pre>        data = [<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">159</th>
  <td class="line-code diff_in">
    <pre>          &quot;--&quot; + boundary,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">160</th>
  <td class="line-code diff_in">
    <pre>          &quot;Content-Disposition: form-data; name=\&quot;userfile\&quot;; filename=\&quot;#{basename}\&quot;&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">161</th>
  <td class="line-code diff_in">
    <pre>          &quot;Content-Type: application/octet-stream&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">162</th>
  <td class="line-code diff_in">
    <pre>          &quot;Content-Transfer-Encoding: binary&quot;,<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">163</th>
  <td class="line-code diff_in">
    <pre>          &quot;&quot;, file_data, &quot;&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">164</th>
  <td class="line-code diff_in">
    <pre>          ].join(&quot;\x0D\x0A&quot;)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">165</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">166</th>
  <td class="line-code diff_in">
    <pre>        release_headers = headers.merge(<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">167</th>
  <td class="line-code diff_in">
    <pre>          &quot;Content-Type&quot; =&gt; &quot;multipart/form-data; boundary=#{boundary}&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">168</th>
  <td class="line-code diff_in">
    <pre>        )<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">169</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">170</th>
  <td class="line-code diff_in">
    <pre>        target = first_file ? &quot;/frs/admin/qrs.php&quot; : &quot;/frs/admin/editrelease.php&quot;<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">171</th>
  <td class="line-code diff_in">
    <pre>        http.post(target + query, data, release_headers)<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">172</th>
  <td class="line-code diff_in">
    <pre>      end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">173</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">174</th>
  <td class="line-code diff_in">
    <pre>      if first_file then<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">175</th>
  <td class="line-code diff_in">
    <pre>        release_id = release_response.body[/release_id=(\d+)/, 1]<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">176</th>
  <td class="line-code diff_in">
    <pre>        raise(&quot;Couldn't get release id&quot;) unless release_id<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">177</th>
  <td class="line-code diff_in">
    <pre>      end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">178</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">179</th>
  <td class="line-code diff_in">
    <pre>      first_file = false<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">180</th>
  <td class="line-code diff_in">
    <pre>    end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">181</th>
  <td class="line-code diff_in">
    <pre>  end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">182</th>
  <th class="line-num">182</th>
  <td class="line-code ">
    <pre>end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">22</th>
  <td class="line-code ">
    <pre>module ActiveRecord #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">23</th>
  <td class="line-code ">
    <pre>  module Acts #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">24</th>
  <td class="line-code ">
    <pre>    # Specify this act if you want to save a copy of the row in a versioned table.  This assumes there is a 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    # versioned table ready and that your model has a version field.  This works with optimis<span></span>ic locking if the lock_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">25</th>
  <td class="line-code diff_in">
    <pre>    # versioned table ready and that your model has a version field.  This works with optimis<span>t</span>ic locking if the lock_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>    # column is present as well.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>    # The class for the versioned model is derived the first time it is seen. Therefore, if you change your database schema you have to restart
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">49</th>
  <th class="line-num">49</th>
  <td class="line-code ">
    <pre>    #   page.revert_to(page.versions.last) # using versioned instance
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">50</th>
  <th class="line-num">50</th>
  <td class="line-code ">
    <pre>    #   page.title         # =&gt; 'hello world'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">51</th>
  <th class="line-num">51</th>
  <td class="line-code ">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">52</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.earliest # efficient query to find the first version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">53</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.latest   # efficient query to find the most recently created version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">54</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">55</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">56</th>
  <td class="line-code diff_in">
    <pre>    # Simple Queries to page between versions
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">57</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">58</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.before(version) 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">59</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.after(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">60</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">61</th>
  <td class="line-code diff_in">
    <pre>    # Access the previous/next versions from the versioned model itself
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">62</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">63</th>
  <td class="line-code diff_in">
    <pre>    #   version = page.versions.latest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">64</th>
  <td class="line-code diff_in">
    <pre>    #   version.previous # go back one version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">65</th>
  <td class="line-code diff_in">
    <pre>    #   version.next     # go forward one version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">66</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">52</th>
  <th class="line-num">67</th>
  <td class="line-code ">
    <pre>    # See ActiveRecord::Acts::Versioned::ClassMethods#acts_as_versioned for configuration options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">53</th>
  <th class="line-num">68</th>
  <td class="line-code ">
    <pre>    module Versioned
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">54</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      CALLBACKS = [:set_new_version, :save_version_on_create, :save_version?, :clear_<span>chang</span>ed_attributes]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">69</th>
  <td class="line-code diff_in">
    <pre>      CALLBACKS = [:set_new_version, :save_version_on_create, :save_version?, :clear_<span>alter</span>ed_attributes]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">55</th>
  <th class="line-num">70</th>
  <td class="line-code ">
    <pre>      def self.included(base) # :nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">56</th>
  <th class="line-num">71</th>
  <td class="line-code ">
    <pre>        base.extend ClassMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">57</th>
  <th class="line-num">72</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">80</th>
  <th class="line-num">95</th>
  <td class="line-code ">
    <pre>        #     end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">81</th>
  <th class="line-num">96</th>
  <td class="line-code ">
    <pre>        #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">82</th>
  <th class="line-num">97</th>
  <td class="line-code ">
    <pre>        # * &lt;tt&gt;if_changed&lt;/tt&gt; - Simple way of specifying attributes that are required to be changed before saving a model.  This takes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">83</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        #   either a symbol or array of symbols.  WARNING - This will attempt to overwrite any attribute setters you may have.<span>  </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">98</th>
  <td class="line-code diff_in">
    <pre>        #   either a symbol or array of symbols.  WARNING - This will attempt to overwrite any attribute setters you may have.<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">84</th>
  <th class="line-num">99</th>
  <td class="line-code ">
    <pre>        #   Use this instead if you want to write your own attribute setters (and ignore if_changed):
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">85</th>
  <th class="line-num">100</th>
  <td class="line-code ">
    <pre>        # 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">86</th>
  <th class="line-num">101</th>
  <td class="line-code ">
    <pre>        #     def name=(new_name)
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">133</th>
  <th class="line-num">148</th>
  <td class="line-code ">
    <pre>        #       # that create_table does
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">134</th>
  <th class="line-num">149</th>
  <td class="line-code ">
    <pre>        #       Post.create_versioned_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">135</th>
  <th class="line-num">150</th>
  <td class="line-code ">
    <pre>        #     end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">136</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # <span>  </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">151</th>
  <td class="line-code diff_in">
    <pre>        # <span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">137</th>
  <th class="line-num">152</th>
  <td class="line-code ">
    <pre>        #     def self.down
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">138</th>
  <th class="line-num">153</th>
  <td class="line-code ">
    <pre>        #       Post.drop_versioned_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">139</th>
  <th class="line-num">154</th>
  <td class="line-code ">
    <pre>        #     end
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">157</th>
  <th class="line-num">172</th>
  <td class="line-code ">
    <pre>          return if self.included_modules.include?(ActiveRecord::Acts::Versioned::ActMethods)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">158</th>
  <th class="line-num">173</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">159</th>
  <th class="line-num">174</th>
  <td class="line-code ">
    <pre>          send :include, ActiveRecord::Acts::Versioned::ActMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">160</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">175</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">161</th>
  <th class="line-num">176</th>
  <td class="line-code ">
    <pre>          cattr_accessor :versioned_class_name, :versioned_foreign_key, :versioned_table_name, :versioned_inheritance_column, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">162</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            :version_column, :max_version_limit, :track_<span>chang</span>ed_attributes, :version_condition, :version_sequence_name, :non_versioned_columns,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">177</th>
  <td class="line-code diff_in">
    <pre>            :version_column, :max_version_limit, :track_<span>alter</span>ed_attributes, :version_condition, :version_sequence_name, :non_versioned_columns,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">163</th>
  <th class="line-num">178</th>
  <td class="line-code ">
    <pre>            :version_association_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">164</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">179</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">165</th>
  <th class="line-num">180</th>
  <td class="line-code ">
    <pre>          # legacy
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">166</th>
  <th class="line-num">181</th>
  <td class="line-code ">
    <pre>          alias_method :non_versioned_fields,  :non_versioned_columns
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">167</th>
  <th class="line-num">182</th>
  <td class="line-code ">
    <pre>          alias_method :non_versioned_fields=, :non_versioned_columns=
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">171</th>
  <th class="line-num">186</th>
  <td class="line-code ">
    <pre>            alias_method :non_versioned_fields=, :non_versioned_columns=
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">172</th>
  <th class="line-num">187</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">173</th>
  <th class="line-num">188</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">174</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          send :attr_accessor, :<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">189</th>
  <td class="line-code diff_in">
    <pre>          send :attr_accessor, :<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">175</th>
  <th class="line-num">190</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">176</th>
  <th class="line-num">191</th>
  <td class="line-code ">
    <pre>          self.versioned_class_name         = options[:class_name]  || &quot;Version&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">177</th>
  <th class="line-num">192</th>
  <td class="line-code ">
    <pre>          self.versioned_foreign_key        = options[:foreign_key] || self.to_s.foreign_key
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">184</th>
  <th class="line-num">199</th>
  <td class="line-code ">
    <pre>          self.non_versioned_columns        = [self.primary_key, inheritance_column, 'version', 'lock_version', versioned_inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">185</th>
  <th class="line-num">200</th>
  <td class="line-code ">
    <pre>          self.version_association_options  = {
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">186</th>
  <th class="line-num">201</th>
  <td class="line-code ">
    <pre>                                                :class_name  =&gt; &quot;#{self.to_s}::#{versioned_class_name}&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">187</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                                                :foreign_key =&gt; &quot;#{versioned_foreign_key}&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">188</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                                                :order       =&gt; 'version',
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">202</th>
  <td class="line-code diff_in">
    <pre>                                                :foreign_key =&gt; versioned_foreign_key,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">189</th>
  <th class="line-num">203</th>
  <td class="line-code ">
    <pre>                                                :dependent   =&gt; :delete_all
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">190</th>
  <th class="line-num">204</th>
  <td class="line-code ">
    <pre>                                              }.merge(options[:association_options] || {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">191</th>
  <th class="line-num">205</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">194</th>
  <th class="line-num">208</th>
  <td class="line-code ">
    <pre>            silence_warnings do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">195</th>
  <th class="line-num">209</th>
  <td class="line-code ">
    <pre>              self.const_set(extension_module_name, Module.new(&amp;extension))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">196</th>
  <th class="line-num">210</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">197</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">211</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">198</th>
  <th class="line-num">212</th>
  <td class="line-code ">
    <pre>            options[:extend] = self.const_get(extension_module_name)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">199</th>
  <th class="line-num">213</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">200</th>
  <th class="line-num">214</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">201</th>
  <th class="line-num">215</th>
  <td class="line-code ">
    <pre>          class_eval do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">202</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            has_many :versions, version_association_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">216</th>
  <td class="line-code diff_in">
    <pre>            has_many :versions, version_association_options do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">217</th>
  <td class="line-code diff_in">
    <pre>              # finds earliest version of this record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">218</th>
  <td class="line-code diff_in">
    <pre>              def earliest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">219</th>
  <td class="line-code diff_in">
    <pre>                @earliest ||= find(:first, :order =&gt; 'version')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">220</th>
  <td class="line-code diff_in">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">221</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">222</th>
  <td class="line-code diff_in">
    <pre>              # find latest version of this record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">223</th>
  <td class="line-code diff_in">
    <pre>              def latest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">224</th>
  <td class="line-code diff_in">
    <pre>                @latest ||= find(:first, :order =&gt; 'version desc')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">225</th>
  <td class="line-code diff_in">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">226</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">203</th>
  <th class="line-num">227</th>
  <td class="line-code ">
    <pre>            before_save  :set_new_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">204</th>
  <th class="line-num">228</th>
  <td class="line-code ">
    <pre>            after_create :save_version_on_create
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">205</th>
  <th class="line-num">229</th>
  <td class="line-code ">
    <pre>            after_update :save_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">206</th>
  <th class="line-num">230</th>
  <td class="line-code ">
    <pre>            after_save   :clear_old_versions
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">207</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            after_save   :clear_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">208</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">231</th>
  <td class="line-code diff_in">
    <pre>            after_save   :clear_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">232</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">209</th>
  <th class="line-num">233</th>
  <td class="line-code ">
    <pre>            unless options[:if_changed].nil?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">210</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              self.track_<span>chang</span>ed_attributes = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">234</th>
  <td class="line-code diff_in">
    <pre>              self.track_<span>alter</span>ed_attributes = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">211</th>
  <th class="line-num">235</th>
  <td class="line-code ">
    <pre>              options[:if_changed] = [options[:if_changed]] unless options[:if_changed].is_a?(Array)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">212</th>
  <th class="line-num">236</th>
  <td class="line-code ">
    <pre>              options[:if_changed].each do |attr_name|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">213</th>
  <th class="line-num">237</th>
  <td class="line-code ">
    <pre>                define_method(&quot;#{attr_name}=&quot;) do |value|
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">215</th>
  <th class="line-num">239</th>
  <td class="line-code ">
    <pre>                end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">216</th>
  <th class="line-num">240</th>
  <td class="line-code ">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">217</th>
  <th class="line-num">241</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">218</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">242</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">219</th>
  <th class="line-num">243</th>
  <td class="line-code ">
    <pre>            include options[:extend] if options[:extend].is_a?(Module)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">220</th>
  <th class="line-num">244</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">221</th>
  <th class="line-num">245</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">222</th>
  <th class="line-num">246</th>
  <td class="line-code ">
    <pre>          # create the dynamic versioned model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">223</th>
  <th class="line-num">247</th>
  <td class="line-code ">
    <pre>          const_set(versioned_class_name, Class.new(ActiveRecord::Base)).class_eval do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">224</th>
  <th class="line-num">248</th>
  <td class="line-code ">
    <pre>            def self.reloadable? ; false ; end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">249</th>
  <td class="line-code diff_in">
    <pre>            # find first version before the given version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">250</th>
  <td class="line-code diff_in">
    <pre>            def self.before(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">251</th>
  <td class="line-code diff_in">
    <pre>              find :first, :order =&gt; 'version desc',
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">252</th>
  <td class="line-code diff_in">
    <pre>                :conditions =&gt; [&quot;#{original_class.versioned_foreign_key} = ? and version &lt; ?&quot;, version.send(original_class.versioned_foreign_key), version.version]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">253</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">254</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">255</th>
  <td class="line-code diff_in">
    <pre>            # find first version after the given version.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">256</th>
  <td class="line-code diff_in">
    <pre>            def self.after(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">257</th>
  <td class="line-code diff_in">
    <pre>              find :first, :order =&gt; 'version',
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">258</th>
  <td class="line-code diff_in">
    <pre>                :conditions =&gt; [&quot;#{original_class.versioned_foreign_key} = ? and version &gt; ?&quot;, version.send(original_class.versioned_foreign_key), version.version]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">259</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">260</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">261</th>
  <td class="line-code diff_in">
    <pre>            def previous
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">262</th>
  <td class="line-code diff_in">
    <pre>              self.class.before(self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">263</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">264</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">265</th>
  <td class="line-code diff_in">
    <pre>            def next
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">266</th>
  <td class="line-code diff_in">
    <pre>              self.class.after(self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">267</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">268</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">269</th>
  <td class="line-code diff_in">
    <pre>            def versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">270</th>
  <td class="line-code diff_in">
    <pre>              page.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">271</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">225</th>
  <th class="line-num">272</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">226</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">273</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">274</th>
  <td class="line-code diff_in">
    <pre>          versioned_class.cattr_accessor :original_class
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">275</th>
  <td class="line-code diff_in">
    <pre>          versioned_class.original_class = self
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">227</th>
  <th class="line-num">276</th>
  <td class="line-code ">
    <pre>          versioned_class.set_table_name versioned_table_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">228</th>
  <th class="line-num">277</th>
  <td class="line-code ">
    <pre>          versioned_class.belongs_to self.to_s.demodulize.underscore.to_sym, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">229</th>
  <th class="line-num">278</th>
  <td class="line-code ">
    <pre>            :class_name  =&gt; &quot;::#{self.to_s}&quot;, 
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">232</th>
  <th class="line-num">281</th>
  <td class="line-code ">
    <pre>          versioned_class.set_sequence_name version_sequence_name if version_sequence_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">233</th>
  <th class="line-num">282</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">234</th>
  <th class="line-num">283</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">235</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">284</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">236</th>
  <th class="line-num">285</th>
  <td class="line-code ">
    <pre>      module ActMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">237</th>
  <th class="line-num">286</th>
  <td class="line-code ">
    <pre>        def self.included(base) # :nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">238</th>
  <th class="line-num">287</th>
  <td class="line-code ">
    <pre>          base.extend ClassMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">239</th>
  <th class="line-num">288</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">240</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">289</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">290</th>
  <td class="line-code diff_in">
    <pre>        # Finds a specific version of this record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">291</th>
  <td class="line-code diff_in">
    <pre>        def find_version(version = nil)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">292</th>
  <td class="line-code diff_in">
    <pre>          self.class.find_version(id, version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">293</th>
  <td class="line-code diff_in">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">294</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">241</th>
  <th class="line-num">295</th>
  <td class="line-code ">
    <pre>        # Saves a version of the model if applicable
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">242</th>
  <th class="line-num">296</th>
  <td class="line-code ">
    <pre>        def save_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">243</th>
  <th class="line-num">297</th>
  <td class="line-code ">
    <pre>          save_version_on_create if save_version?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">244</th>
  <th class="line-num">298</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">245</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">299</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">246</th>
  <th class="line-num">300</th>
  <td class="line-code ">
    <pre>        # Saves a version of the model in the versioned table.  This is called in the after_save callback by default
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">247</th>
  <th class="line-num">301</th>
  <td class="line-code ">
    <pre>        def save_version_on_create
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">248</th>
  <th class="line-num">302</th>
  <td class="line-code ">
    <pre>          rev = self.class.versioned_class.new
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">263</th>
  <th class="line-num">317</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">264</th>
  <th class="line-num">318</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">265</th>
  <th class="line-num">319</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">266</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # Finds a specific version of this model.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">267</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        def find_version(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">268</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          return version if version.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">269</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          return nil if version.is_a?(ActiveRecord::Base)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">270</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          find_versions(:conditions =&gt; ['version = ?', version], :limit =&gt; 1).first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">271</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">272</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">273</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # Finds versions of this model.  Takes an options hash like &lt;tt&gt;find&lt;/tt&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">274</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        def find_versions(options = {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">275</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          versions.find(:all, options)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">320</th>
  <td class="line-code diff_in">
    <pre>        def versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">321</th>
  <td class="line-code diff_in">
    <pre>          version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">276</th>
  <th class="line-num">322</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">277</th>
  <th class="line-num">323</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">278</th>
  <th class="line-num">324</th>
  <td class="line-code ">
    <pre>        # Reverts a model to a given version.  Takes either a version number or an instance of the versioned model
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">280</th>
  <th class="line-num">326</th>
  <td class="line-code ">
    <pre>          if version.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">281</th>
  <th class="line-num">327</th>
  <td class="line-code ">
    <pre>            return false unless version.send(self.class.versioned_foreign_key) == self.id and !version.new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">282</th>
  <th class="line-num">328</th>
  <td class="line-code ">
    <pre>          else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">283</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false unless version = <span>find</span>_version(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">329</th>
  <td class="line-code diff_in">
    <pre>            return false unless version = <span>versions.find_by</span>_version(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">284</th>
  <th class="line-num">330</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">285</th>
  <th class="line-num">331</th>
  <td class="line-code ">
    <pre>          self.clone_versioned_model(version, self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">286</th>
  <th class="line-num">332</th>
  <td class="line-code ">
    <pre>          self.send(&quot;#{self.class.version_column}=&quot;, version.version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">287</th>
  <th class="line-num">333</th>
  <td class="line-code ">
    <pre>          true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">288</th>
  <th class="line-num">334</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">289</th>
  <th class="line-num">335</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">290</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # Reverts a model to a given version and saves the model.<span>  </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">336</th>
  <td class="line-code diff_in">
    <pre>        # Reverts a model to a given version and saves the model.<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">291</th>
  <th class="line-num">337</th>
  <td class="line-code ">
    <pre>        # Takes either a version number or an instance of the versioned model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">292</th>
  <th class="line-num">338</th>
  <td class="line-code ">
    <pre>        def revert_to!(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">293</th>
  <th class="line-num">339</th>
  <td class="line-code ">
    <pre>          revert_to(version) ? save_without_revision : false
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">313</th>
  <th class="line-num">359</th>
  <td class="line-code ">
    <pre>        def versioned_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">314</th>
  <th class="line-num">360</th>
  <td class="line-code ">
    <pre>          self.attributes.keys.select { |k| !self.class.non_versioned_columns.include?(k) }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">315</th>
  <th class="line-num">361</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">316</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">362</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">317</th>
  <th class="line-num">363</th>
  <td class="line-code ">
    <pre>        # If called with no parameters, gets whether the current model has changed and needs to be versioned.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">318</th>
  <th class="line-num">364</th>
  <td class="line-code ">
    <pre>        # If called with a single parameter, gets whether the parameter has changed.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">319</th>
  <th class="line-num">365</th>
  <td class="line-code ">
    <pre>        def changed?(attr_name = nil)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">320</th>
  <th class="line-num">366</th>
  <td class="line-code ">
    <pre>          attr_name.nil? ?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">321</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            (!self.class.track_<span>changed_attributes || (changed_attributes &amp;&amp; chang</span>ed_attributes.length &gt; 0)) :
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">322</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            (<span>changed_attributes &amp;&amp; chang</span>ed_attributes.include?(attr_name.to_s))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">367</th>
  <td class="line-code diff_in">
    <pre>            (!self.class.track_<span>altered_attributes || (altered_attributes &amp;&amp; alter</span>ed_attributes.length &gt; 0)) :
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">368</th>
  <td class="line-code diff_in">
    <pre>            (<span>altered_attributes &amp;&amp; alter</span>ed_attributes.include?(attr_name.to_s))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">323</th>
  <th class="line-num">369</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">324</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">370</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">325</th>
  <th class="line-num">371</th>
  <td class="line-code ">
    <pre>        # keep old dirty? method
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">326</th>
  <th class="line-num">372</th>
  <td class="line-code ">
    <pre>        alias_method :dirty?, :changed?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">327</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">373</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">328</th>
  <th class="line-num">374</th>
  <td class="line-code ">
    <pre>        # Clones a model.  Used when saving a new version or reverting a model's version.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">329</th>
  <th class="line-num">375</th>
  <td class="line-code ">
    <pre>        def clone_versioned_model(orig_model, new_model)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">330</th>
  <th class="line-num">376</th>
  <td class="line-code ">
    <pre>          self.versioned_attributes.each do |key|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">331</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            new_model.send(&quot;#{key}=&quot;, orig_model.<span>attributes[key]</span>) if orig_model.has_attribute?(key)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">377</th>
  <td class="line-code diff_in">
    <pre>            new_model.send(&quot;#{key}=&quot;, orig_model.<span>send(key)</span>) if orig_model.has_attribute?(key)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">332</th>
  <th class="line-num">378</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">333</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">379</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">334</th>
  <th class="line-num">380</th>
  <td class="line-code ">
    <pre>          if orig_model.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">335</th>
  <th class="line-num">381</th>
  <td class="line-code ">
    <pre>            new_model[new_model.class.inheritance_column] = orig_model[self.class.versioned_inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">336</th>
  <th class="line-num">382</th>
  <td class="line-code ">
    <pre>          elsif new_model.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">337</th>
  <th class="line-num">383</th>
  <td class="line-code ">
    <pre>            new_model[self.class.versioned_inheritance_column] = orig_model[orig_model.class.inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">338</th>
  <th class="line-num">384</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">339</th>
  <th class="line-num">385</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">340</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">386</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">341</th>
  <th class="line-num">387</th>
  <td class="line-code ">
    <pre>        # Checks whether a new version shall be saved or not.  Calls &lt;tt&gt;version_condition_met?&lt;/tt&gt; and &lt;tt&gt;changed?&lt;/tt&gt;.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">342</th>
  <th class="line-num">388</th>
  <td class="line-code ">
    <pre>        def save_version?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">343</th>
  <th class="line-num">389</th>
  <td class="line-code ">
    <pre>          version_condition_met? &amp;&amp; changed?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">344</th>
  <th class="line-num">390</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">345</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">391</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">346</th>
  <th class="line-num">392</th>
  <td class="line-code ">
    <pre>        # Checks condition set in the :if option to check whether a revision should be created or not.  Override this for
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">347</th>
  <th class="line-num">393</th>
  <td class="line-code ">
    <pre>        # custom version condition checking.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">348</th>
  <th class="line-num">394</th>
  <td class="line-code ">
    <pre>        def version_condition_met?
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">353</th>
  <th class="line-num">399</th>
  <td class="line-code ">
    <pre>            version_condition.call(self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">354</th>
  <th class="line-num">400</th>
  <td class="line-code ">
    <pre>          else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">355</th>
  <th class="line-num">401</th>
  <td class="line-code ">
    <pre>            version_condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">356</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          end<span>          </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">402</th>
  <td class="line-code diff_in">
    <pre>          end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">357</th>
  <th class="line-num">403</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">358</th>
  <th class="line-num">404</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">359</th>
  <th class="line-num">405</th>
  <td class="line-code ">
    <pre>        # Executes the block with the versioning callbacks disabled.
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">378</th>
  <th class="line-num">424</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">379</th>
  <th class="line-num">425</th>
  <td class="line-code ">
    <pre>        def empty_callback() end #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">380</th>
  <th class="line-num">426</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">381</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        protected<span>          </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">427</th>
  <td class="line-code diff_in">
    <pre>        protected<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">382</th>
  <th class="line-num">428</th>
  <td class="line-code ">
    <pre>          # sets the new version before saving, unless you're using optimistic locking.  In that case, let it take care of the version.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">383</th>
  <th class="line-num">429</th>
  <td class="line-code ">
    <pre>          def set_new_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">384</th>
  <th class="line-num">430</th>
  <td class="line-code ">
    <pre>            self.send(&quot;#{self.class.version_column}=&quot;, self.next_version) if new_record? || (!locking_enabled? &amp;&amp; save_version?)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">385</th>
  <th class="line-num">431</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">386</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">432</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">387</th>
  <th class="line-num">433</th>
  <td class="line-code ">
    <pre>          # Gets the next available version for the current record, or 1 for a new record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">388</th>
  <th class="line-num">434</th>
  <td class="line-code ">
    <pre>          def next_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">389</th>
  <th class="line-num">435</th>
  <td class="line-code ">
    <pre>            return 1 if new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">390</th>
  <th class="line-num">436</th>
  <td class="line-code ">
    <pre>            (versions.calculate(:max, :version) || 0) + 1
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">391</th>
  <th class="line-num">437</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">392</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">438</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">393</th>
  <th class="line-num">439</th>
  <td class="line-code ">
    <pre>          # clears current changed attributes.  Called after save.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">394</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          def clear_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">395</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            self.<span>chang</span>ed_attributes = []
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">440</th>
  <td class="line-code diff_in">
    <pre>          def clear_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">441</th>
  <td class="line-code diff_in">
    <pre>            self.<span>alter</span>ed_attributes = []
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">396</th>
  <th class="line-num">442</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">397</th>
  <th class="line-num">443</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">398</th>
  <th class="line-num">444</th>
  <td class="line-code ">
    <pre>          def write_changed_attribute(attr_name, attr_value)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">399</th>
  <th class="line-num">445</th>
  <td class="line-code ">
    <pre>            # Convert to db type for comparison. Avoids failing Float&lt;=&gt;String comparisons.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">400</th>
  <th class="line-num">446</th>
  <td class="line-code ">
    <pre>            attr_value_for_db = self.class.columns_hash[attr_name.to_s].type_cast(attr_value)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">401</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            (self.<span>chang</span>ed_attributes ||= []) &lt;&lt; attr_name.to_s unless self.changed?(attr_name) || self.send(attr_name) == attr_value_for_db
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">447</th>
  <td class="line-code diff_in">
    <pre>            (self.<span>alter</span>ed_attributes ||= []) &lt;&lt; attr_name.to_s unless self.changed?(attr_name) || self.send(attr_name) == attr_value_for_db
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">402</th>
  <th class="line-num">448</th>
  <td class="line-code ">
    <pre>            write_attribute(attr_name, attr_value_for_db)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">403</th>
  <th class="line-num">449</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">404</th>
  <th class="line-num">450</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">405</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        private
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">406</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          CALLBACKS.each do |attr_name| 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">407</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            alias_method &quot;orig_#{attr_name}&quot;.to_sym, attr_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">408</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">409</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">410</th>
  <th class="line-num">451</th>
  <td class="line-code ">
    <pre>        module ClassMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">411</th>
  <th class="line-num">452</th>
  <td class="line-code ">
    <pre>          # Finds a specific version of a specific row of this model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">412</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          def find_version(id, version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">413</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            find_versions(id, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">414</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              :conditions =&gt; [&quot;#{versioned_foreign_key} = ? AND version = ?&quot;, id, version], 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">415</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              :limit =&gt; 1).first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">453</th>
  <td class="line-code diff_in">
    <pre>          def find_version(id, version = nil)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">454</th>
  <td class="line-code diff_in">
    <pre>            return find(id) unless version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">455</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">456</th>
  <td class="line-code diff_in">
    <pre>            conditions = [&quot;#{versioned_foreign_key} = ? AND version = ?&quot;, id, version]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">457</th>
  <td class="line-code diff_in">
    <pre>            options = { :conditions =&gt; conditions, :limit =&gt; 1 }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">458</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">459</th>
  <td class="line-code diff_in">
    <pre>            if result = find_versions(id, options).first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">460</th>
  <td class="line-code diff_in">
    <pre>              result
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">461</th>
  <td class="line-code diff_in">
    <pre>            else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">462</th>
  <td class="line-code diff_in">
    <pre>              raise RecordNotFound, &quot;Couldn't find #{name} with ID=#{id} and VERSION=#{version}&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">463</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">416</th>
  <th class="line-num">464</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">417</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">465</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">418</th>
  <th class="line-num">466</th>
  <td class="line-code ">
    <pre>          # Finds versions of a specific model.  Takes an options hash like &lt;tt&gt;find&lt;/tt&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">419</th>
  <th class="line-num">467</th>
  <td class="line-code ">
    <pre>          def find_versions(id, options = {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">420</th>
  <th class="line-num">468</th>
  <td class="line-code ">
    <pre>            versioned_class.find :all, {
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">426</th>
  <th class="line-num">474</th>
  <td class="line-code ">
    <pre>          def versioned_columns
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">427</th>
  <th class="line-num">475</th>
  <td class="line-code ">
    <pre>            self.columns.select { |c| !non_versioned_columns.include?(c.name) }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">428</th>
  <th class="line-num">476</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">429</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">477</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">430</th>
  <th class="line-num">478</th>
  <td class="line-code ">
    <pre>          # Returns an instance of the dynamic versioned model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">431</th>
  <th class="line-num">479</th>
  <td class="line-code ">
    <pre>          def versioned_class
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">432</th>
  <th class="line-num">480</th>
  <td class="line-code ">
    <pre>            const_get versioned_class_name
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">438</th>
  <th class="line-num">486</th>
  <td class="line-code ">
    <pre>            if !self.content_columns.find { |c| %w(version lock_version).include? c.name }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">439</th>
  <th class="line-num">487</th>
  <td class="line-code ">
    <pre>              self.connection.add_column table_name, :version, :integer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">440</th>
  <th class="line-num">488</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">441</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">489</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">442</th>
  <th class="line-num">490</th>
  <td class="line-code ">
    <pre>            self.connection.create_table(versioned_table_name, create_table_options) do |t|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">443</th>
  <th class="line-num">491</th>
  <td class="line-code ">
    <pre>              t.column versioned_foreign_key, :integer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">444</th>
  <th class="line-num">492</th>
  <td class="line-code ">
    <pre>              t.column :version, :integer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">445</th>
  <th class="line-num">493</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">446</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">494</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">447</th>
  <th class="line-num">495</th>
  <td class="line-code ">
    <pre>            updated_col = nil
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">448</th>
  <th class="line-num">496</th>
  <td class="line-code ">
    <pre>            self.versioned_columns.each do |col| 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">449</th>
  <th class="line-num">497</th>
  <td class="line-code ">
    <pre>              updated_col = col if !updated_col &amp;&amp; %(updated_at updated_on).include?(col.name)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">450</th>
  <th class="line-num">498</th>
  <td class="line-code ">
    <pre>              self.connection.add_column versioned_table_name, col.name, col.type, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">451</th>
  <th class="line-num">499</th>
  <td class="line-code ">
    <pre>                :limit =&gt; col.limit, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">452</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                :default =&gt; col.default
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">500</th>
  <td class="line-code diff_in">
    <pre>                :default =&gt; col.default,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">501</th>
  <td class="line-code diff_in">
    <pre>                :scale =&gt; col.scale,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">502</th>
  <td class="line-code diff_in">
    <pre>                :precision =&gt; col.precision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">453</th>
  <th class="line-num">503</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">454</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">504</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">455</th>
  <th class="line-num">505</th>
  <td class="line-code ">
    <pre>            if type_col = self.columns_hash[inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">456</th>
  <th class="line-num">506</th>
  <td class="line-code ">
    <pre>              self.connection.add_column versioned_table_name, versioned_inheritance_column, type_col.type, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">457</th>
  <th class="line-num">507</th>
  <td class="line-code ">
    <pre>                :limit =&gt; type_col.limit, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">458</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                :default =&gt; type_col.default
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">508</th>
  <td class="line-code diff_in">
    <pre>                :default =&gt; type_col.default,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">509</th>
  <td class="line-code diff_in">
    <pre>                :scale =&gt; type_col.scale,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">510</th>
  <td class="line-code diff_in">
    <pre>                :precision =&gt; type_col.precision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">459</th>
  <th class="line-num">511</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">460</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">512</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">461</th>
  <th class="line-num">513</th>
  <td class="line-code ">
    <pre>            if updated_col.nil?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">462</th>
  <th class="line-num">514</th>
  <td class="line-code ">
    <pre>              self.connection.add_column versioned_table_name, :updated_at, :timestamp
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">463</th>
  <th class="line-num">515</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">464</th>
  <th class="line-num">516</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">465</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">517</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">466</th>
  <th class="line-num">518</th>
  <td class="line-code ">
    <pre>          # Rake migration task to drop the versioned table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">467</th>
  <th class="line-num">519</th>
  <td class="line-code ">
    <pre>          def drop_versioned_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">468</th>
  <th class="line-num">520</th>
  <td class="line-code ">
    <pre>            self.connection.drop_table versioned_table_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">469</th>
  <th class="line-num">521</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">470</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">522</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">471</th>
  <th class="line-num">523</th>
  <td class="line-code ">
    <pre>          # Executes the block with the versioning callbacks disabled.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">472</th>
  <th class="line-num">524</th>
  <td class="line-code ">
    <pre>          #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">473</th>
  <th class="line-num">525</th>
  <td class="line-code ">
    <pre>          #   Foo.without_revision do
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">476</th>
  <th class="line-num">528</th>
  <td class="line-code ">
    <pre>          #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">477</th>
  <th class="line-num">529</th>
  <td class="line-code ">
    <pre>          def without_revision(&amp;block)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">478</th>
  <th class="line-num">530</th>
  <td class="line-code ">
    <pre>            class_eval do 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">479</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              CALLBACKS.each do |attr_name| 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">531</th>
  <td class="line-code diff_in">
    <pre>              CALLBACKS.each do |attr_name|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">532</th>
  <td class="line-code diff_in">
    <pre>                alias_method &quot;orig_#{attr_name}&quot;.to_sym, attr_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">480</th>
  <th class="line-num">533</th>
  <td class="line-code ">
    <pre>                alias_method attr_name, :empty_callback
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">481</th>
  <th class="line-num">534</th>
  <td class="line-code ">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">482</th>
  <th class="line-num">535</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">483</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            result = block.call
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">536</th>
  <td class="line-code diff_in">
    <pre>            block.call
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">537</th>
  <td class="line-code diff_in">
    <pre>          ensure
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">484</th>
  <th class="line-num">538</th>
  <td class="line-code ">
    <pre>            class_eval do 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">485</th>
  <th class="line-num">539</th>
  <td class="line-code ">
    <pre>              CALLBACKS.each do |attr_name|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">486</th>
  <th class="line-num">540</th>
  <td class="line-code ">
    <pre>                alias_method attr_name, &quot;orig_#{attr_name}&quot;.to_sym
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">487</th>
  <th class="line-num">541</th>
  <td class="line-code ">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">488</th>
  <th class="line-num">542</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">489</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            result
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">490</th>
  <th class="line-num">543</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">491</th>
  <th class="line-num">544</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">492</th>
  <th class="line-num">545</th>
  <td class="line-code ">
    <pre>          # Turns off optimistic locking for the duration of the block
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">501</th>
  <th class="line-num">554</th>
  <td class="line-code ">
    <pre>            result = block.call
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">502</th>
  <th class="line-num">555</th>
  <td class="line-code ">
    <pre>            ActiveRecord::Base.lock_optimistically = true if current
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">503</th>
  <th class="line-num">556</th>
  <td class="line-code ">
    <pre>            result
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">504</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          end<span>          </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">557</th>
  <td class="line-code diff_in">
    <pre>          end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">505</th>
  <th class="line-num">558</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">506</th>
  <th class="line-num">559</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">507</th>
  <th class="line-num">560</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/test/abstract_unit.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num"></th>
  <th class="line-num">1</th>
  <td class="line-code diff_in">
    <pre>$:.unshift(File.dirname(__FILE__) + '/../../../rails/activesupport/lib')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">2</th>
  <td class="line-code diff_in">
    <pre>$:.unshift(File.dirname(__FILE__) + '/../../../rails/activerecord/lib')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">1</th>
  <th class="line-num">3</th>
  <td class="line-code ">
    <pre>$:.unshift(File.dirname(__FILE__) + '/../lib')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num">4</th>
  <td class="line-code ">
    <pre>require 'test/unit'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require File.expand_path(File.join(File.dirname(__FILE__), '../../../../config/environment.rb'))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>require 'active_record/fixtures'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">5</th>
  <td class="line-code diff_in">
    <pre>begin
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">6</th>
  <td class="line-code diff_in">
    <pre>  require 'active_support'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>  require 'active_record'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">8</th>
  <td class="line-code diff_in">
    <pre>  require 'active_record/fixtures'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">9</th>
  <td class="line-code diff_in">
    <pre>rescue LoadError
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">10</th>
  <td class="line-code diff_in">
    <pre>  require 'rubygems'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">11</th>
  <td class="line-code diff_in">
    <pre>  retry
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">12</th>
  <td class="line-code diff_in">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">13</th>
  <td class="line-code diff_in">
    <pre>require 'acts_as_versioned'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">14</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num">15</th>
  <td class="line-code ">
    <pre>config = YAML::load(IO.read(File.dirname(__FILE__) + '/database.yml'))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num">16</th>
  <td class="line-code ">
    <pre>ActiveRecord::Base.logger = Logger.new(File.dirname(__FILE__) + &quot;/debug.log&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>ActiveRecord::Base.establish_connection(config[ENV['DB'] || 'sqlite'])
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">17</th>
  <td class="line-code diff_in">
    <pre>ActiveRecord::Base.configurations = {'test' =&gt; config[ENV['DB'] || 'sqlite3']}
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">18</th>
  <td class="line-code diff_in">
    <pre>ActiveRecord::Base.establish_connection(ActiveRecord::Base.configurations['test'])
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num">19</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">20</th>
  <td class="line-code ">
    <pre>load(File.dirname(__FILE__) + &quot;/schema.rb&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num">21</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">19</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">20</th>
  <th class="line-num">29</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">21</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>Test::Unit::TestCase.fixture_path = File.dirname(__FILE__) + &quot;/fixtures/&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">22</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>$<span>LOAD_PATH</span>.unshift(Test::Unit::TestCase.fixture_path)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">31</th>
  <td class="line-code diff_in">
    <pre>$<span>:</span>.unshift(Test::Unit::TestCase.fixture_path)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">32</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">33</th>
  <td class="line-code ">
    <pre>class Test::Unit::TestCase #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def create_fixtures(*table_names)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    if block_given?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      Fixtures.create_fixtures(Test::Unit::TestCase.fixture_path, table_names) { yield }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">29</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      Fixtures.create_fixtures(Test::Unit::TestCase.fixture_path, table_names)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">30</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">31</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">32</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">33</th>
  <th class="line-num">34</th>
  <td class="line-code ">
    <pre>  # Turn off transactional fixtures if you're working with MyISAM tables in MySQL
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">34</th>
  <th class="line-num">35</th>
  <td class="line-code ">
    <pre>  self.use_transactional_fixtures = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">35</th>
  <th class="line-num">36</th>
  <td class="line-code ">
    <pre>  
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/test/fixtures/widget.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num">1</th>
  <td class="line-code ">
    <pre>class Widget &lt; ActiveRecord::Base
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num">2</th>
  <td class="line-code ">
    <pre>  acts_as_versioned :sequence_name =&gt; 'widgets_seq', :association_options =&gt; {
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    :dependent =&gt; <span>nil</span>, :order =&gt; 'version desc'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>    :dependent =&gt; <span>:nullify</span>, :order =&gt; 'version desc'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">4</th>
  <th class="line-num">4</th>
  <td class="line-code ">
    <pre>  }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre>  non_versioned_columns &lt;&lt; 'foo'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/test/migration_test.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">9</th>
  <th class="line-num">9</th>
  <td class="line-code ">
    <pre>  class MigrationTest &lt; Test::Unit::TestCase
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num">10</th>
  <td class="line-code ">
    <pre>    self.use_transactional_fixtures = false
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">11</th>
  <td class="line-code ">
    <pre>    def teardown
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      ActiveRecord::Base.connection.initialize_schema_information
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">13</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      ActiveRecord::Base.connection.update &quot;UPDATE schema_info SET version = 0&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">14</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">12</th>
  <td class="line-code diff_in">
    <pre>      if ActiveRecord::Base.connection.respond_to?(:initialize_schema_information)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">13</th>
  <td class="line-code diff_in">
    <pre>        ActiveRecord::Base.connection.initialize_schema_information
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">14</th>
  <td class="line-code diff_in">
    <pre>        ActiveRecord::Base.connection.update &quot;UPDATE schema_info SET version = 0&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">15</th>
  <td class="line-code diff_in">
    <pre>      else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">16</th>
  <td class="line-code diff_in">
    <pre>        ActiveRecord::Base.connection.initialize_schema_migrations_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">17</th>
  <td class="line-code diff_in">
    <pre>        ActiveRecord::Base.connection.assume_migrated_upto_version(0)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">18</th>
  <td class="line-code diff_in">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">19</th>
  <td class="line-code diff_in">
    <pre>      
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">15</th>
  <th class="line-num">20</th>
  <td class="line-code ">
    <pre>      Thing.connection.drop_table &quot;things&quot; rescue nil
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">16</th>
  <th class="line-num">21</th>
  <td class="line-code ">
    <pre>      Thing.connection.drop_table &quot;thing_versions&quot; rescue nil
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">17</th>
  <th class="line-num">22</th>
  <td class="line-code ">
    <pre>      Thing.reset_column_information
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">21</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>      assert_raises(ActiveRecord::StatementInvalid) { Thing.create :title =&gt; 'blah blah' }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>      # take 'er up
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>      ActiveRecord::Migrator.up(File.dirname(__FILE__) + '/fixtures/migrations/')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      t = Thing.create :title =&gt; 'blah blah'<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">29</th>
  <td class="line-code diff_in">
    <pre>      t = Thing.create :title =&gt; 'blah blah'<span>, :price =&gt; 123.45, :type =&gt; 'Thing'</span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>      assert_equal 1, t.versions.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">31</th>
  <td class="line-code diff_in">
    <pre>      
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">32</th>
  <td class="line-code diff_in">
    <pre>      # check that the price column has remembered its value correctly
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">33</th>
  <td class="line-code diff_in">
    <pre>      assert_equal t.price,  t.versions.first.price
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">34</th>
  <td class="line-code diff_in">
    <pre>      assert_equal t.title,  t.versions.first.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">35</th>
  <td class="line-code diff_in">
    <pre>      assert_equal t[:type], t.versions.first[:type]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">36</th>
  <td class="line-code diff_in">
    <pre>      
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">37</th>
  <td class="line-code diff_in">
    <pre>      # make sure that the precision of the price column has been preserved
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">38</th>
  <td class="line-code diff_in">
    <pre>      assert_equal 7, Thing::Version.columns.find{|c| c.name == &quot;price&quot;}.precision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">39</th>
  <td class="line-code diff_in">
    <pre>      assert_equal 2, Thing::Version.columns.find{|c| c.name == &quot;price&quot;}.scale
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">40</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">41</th>
  <td class="line-code ">
    <pre>      # now lets take 'er back down
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">42</th>
  <td class="line-code ">
    <pre>      ActiveRecord::Migrator.down(File.dirname(__FILE__) + '/fixtures/migrations/')
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/test/versioned_test.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">4</th>
  <th class="line-num">4</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">5</th>
  <th class="line-num">5</th>
  <td class="line-code ">
    <pre>class VersionedTest &lt; Test::Unit::TestCase
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">6</th>
  <th class="line-num">6</th>
  <td class="line-code ">
    <pre>  fixtures :pages, :page_versions, :locked_pages, :locked_pages_revisions, :authors, :landmarks, :landmark_versions
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>  set_fixture_class :page_versions =&gt; Page::Version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">7</th>
  <th class="line-num">8</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">8</th>
  <th class="line-num">9</th>
  <td class="line-code ">
    <pre>  def test_saves_versioned_copy
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">9</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = Page.create<span></span> :title =&gt; 'first title', :body =&gt; 'first body'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">10</th>
  <td class="line-code diff_in">
    <pre>    p = Page.create<span>!</span> :title =&gt; 'first title', :body =&gt; 'first body'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">10</th>
  <th class="line-num">11</th>
  <td class="line-code ">
    <pre>    assert !p.new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">11</th>
  <th class="line-num">12</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">12</th>
  <th class="line-num">13</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">16</th>
  <th class="line-num">17</th>
  <td class="line-code ">
    <pre>  def test_saves_without_revision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">17</th>
  <th class="line-num">18</th>
  <td class="line-code ">
    <pre>    p = pages(:welcome)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">18</th>
  <th class="line-num">19</th>
  <td class="line-code ">
    <pre>    old_versions = p.versions.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">19</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">20</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">20</th>
  <th class="line-num">21</th>
  <td class="line-code ">
    <pre>    p.save_without_revision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">21</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">22</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">23</th>
  <td class="line-code ">
    <pre>    p.without_revision do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">24</th>
  <td class="line-code ">
    <pre>      p.update_attributes :title =&gt; 'changed'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">25</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">26</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>    assert_equal old_versions, p.versions.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">29</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">30</th>
  <th class="line-num">31</th>
  <td class="line-code ">
    <pre>    p = pages(:welcome)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">31</th>
  <th class="line-num">32</th>
  <td class="line-code ">
    <pre>    assert_equal 24, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">32</th>
  <th class="line-num">33</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblog', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">33</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">34</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">34</th>
  <th class="line-num">35</th>
  <td class="line-code ">
    <pre>    assert p.revert_to!(p.versions.first.version), &quot;Couldn't revert to 23&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">35</th>
  <th class="line-num">36</th>
  <td class="line-code ">
    <pre>    assert_equal 23, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">36</th>
  <th class="line-num">37</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblg', p.title
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">57</th>
  <th class="line-num">58</th>
  <td class="line-code ">
    <pre>    p = pages(:welcome)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">58</th>
  <th class="line-num">59</th>
  <td class="line-code ">
    <pre>    assert_equal 24, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">59</th>
  <th class="line-num">60</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblog', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">60</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">61</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">61</th>
  <th class="line-num">62</th>
  <td class="line-code ">
    <pre>    assert p.revert_to!(p.versions.first), &quot;Couldn't revert to 23&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">62</th>
  <th class="line-num">63</th>
  <td class="line-code ">
    <pre>    assert_equal 23, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">63</th>
  <th class="line-num">64</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblg', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">64</th>
  <th class="line-num">65</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">65</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">66</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">66</th>
  <th class="line-num">67</th>
  <td class="line-code ">
    <pre>  def test_rollback_fails_with_invalid_revision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">67</th>
  <th class="line-num">68</th>
  <td class="line-code ">
    <pre>    p = locked_pages(:welcome)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">68</th>
  <th class="line-num">69</th>
  <td class="line-code ">
    <pre>    assert !p.revert_to!(locked_pages(:thinking))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">69</th>
  <th class="line-num">70</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">70</th>
  <th class="line-num">71</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">71</th>
  <th class="line-num">72</th>
  <td class="line-code ">
    <pre>  def test_saves_versioned_copy_with_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">72</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = LockedPage.create<span></span> :title =&gt; 'first title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">73</th>
  <td class="line-code diff_in">
    <pre>    p = LockedPage.create<span>!</span> :title =&gt; 'first title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">73</th>
  <th class="line-num">74</th>
  <td class="line-code ">
    <pre>    assert !p.new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">74</th>
  <th class="line-num">75</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">75</th>
  <th class="line-num">76</th>
  <td class="line-code ">
    <pre>    assert_instance_of LockedPage.versioned_class, p.versions.first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">76</th>
  <th class="line-num">77</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">77</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">78</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">78</th>
  <th class="line-num">79</th>
  <td class="line-code ">
    <pre>  def test_rollback_with_version_number_with_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">79</th>
  <th class="line-num">80</th>
  <td class="line-code ">
    <pre>    p = locked_pages(:welcome)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">80</th>
  <th class="line-num">81</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblog', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">81</th>
  <th class="line-num">82</th>
  <td class="line-code ">
    <pre>    assert_equal 'LockedPage', p.versions.first.version_type
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">82</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">83</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">83</th>
  <th class="line-num">84</th>
  <td class="line-code ">
    <pre>    assert p.revert_to!(p.versions.first.version), &quot;Couldn't revert to 23&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">84</th>
  <th class="line-num">85</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblg', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">85</th>
  <th class="line-num">86</th>
  <td class="line-code ">
    <pre>    assert_equal 'LockedPage', p.versions.first.version_type
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">86</th>
  <th class="line-num">87</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">87</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">88</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">88</th>
  <th class="line-num">89</th>
  <td class="line-code ">
    <pre>  def test_rollback_with_version_class_with_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">89</th>
  <th class="line-num">90</th>
  <td class="line-code ">
    <pre>    p = locked_pages(:welcome)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">90</th>
  <th class="line-num">91</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblog', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">91</th>
  <th class="line-num">92</th>
  <td class="line-code ">
    <pre>    assert_equal 'LockedPage', p.versions.first.version_type
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">92</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">93</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">93</th>
  <th class="line-num">94</th>
  <td class="line-code ">
    <pre>    assert p.revert_to!(p.versions.first), &quot;Couldn't revert to 1&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">94</th>
  <th class="line-num">95</th>
  <td class="line-code ">
    <pre>    assert_equal 'Welcome to the weblg', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">95</th>
  <th class="line-num">96</th>
  <td class="line-code ">
    <pre>    assert_equal 'LockedPage', p.versions.first.version_type
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">96</th>
  <th class="line-num">97</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">97</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">98</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">98</th>
  <th class="line-num">99</th>
  <td class="line-code ">
    <pre>  def test_saves_versioned_copy_with_sti
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">99</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = SpecialLockedPage.create<span></span> :title =&gt; 'first title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">100</th>
  <td class="line-code diff_in">
    <pre>    p = SpecialLockedPage.create<span>!</span> :title =&gt; 'first title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">100</th>
  <th class="line-num">101</th>
  <td class="line-code ">
    <pre>    assert !p.new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">101</th>
  <th class="line-num">102</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">102</th>
  <th class="line-num">103</th>
  <td class="line-code ">
    <pre>    assert_instance_of LockedPage.versioned_class, p.versions.first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">103</th>
  <th class="line-num">104</th>
  <td class="line-code ">
    <pre>    assert_equal 'SpecialLockedPage', p.versions.first.version_type
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">104</th>
  <th class="line-num">105</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">105</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">106</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">106</th>
  <th class="line-num">107</th>
  <td class="line-code ">
    <pre>  def test_rollback_with_version_number_with_sti
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">107</th>
  <th class="line-num">108</th>
  <td class="line-code ">
    <pre>    p = locked_pages(:thinking)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">108</th>
  <th class="line-num">109</th>
  <td class="line-code ">
    <pre>    assert_equal 'So I was thinking', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">109</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">110</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">110</th>
  <th class="line-num">111</th>
  <td class="line-code ">
    <pre>    assert p.revert_to!(p.versions.first.version), &quot;Couldn't revert to 1&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">111</th>
  <th class="line-num">112</th>
  <td class="line-code ">
    <pre>    assert_equal 'So I was thinking!!!', p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">112</th>
  <th class="line-num">113</th>
  <td class="line-code ">
    <pre>    assert_equal 'SpecialLockedPage', p.versions.first.version_type
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">115</th>
  <th class="line-num">116</th>
  <td class="line-code ">
    <pre>  def test_lock_version_works_with_versioning
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">116</th>
  <th class="line-num">117</th>
  <td class="line-code ">
    <pre>    p = locked_pages(:thinking)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">117</th>
  <th class="line-num">118</th>
  <td class="line-code ">
    <pre>    p2 = LockedPage.find(p.id)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">118</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">119</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">119</th>
  <th class="line-num">120</th>
  <td class="line-code ">
    <pre>    p.title = 'fresh title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">120</th>
  <th class="line-num">121</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">121</th>
  <th class="line-num">122</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.versions.size # limit!
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">122</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">123</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">123</th>
  <th class="line-num">124</th>
  <td class="line-code ">
    <pre>    assert_raises(ActiveRecord::StaleObjectError) do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">124</th>
  <th class="line-num">125</th>
  <td class="line-code ">
    <pre>      p2.title = 'stale title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">125</th>
  <th class="line-num">126</th>
  <td class="line-code ">
    <pre>      p2.save
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">127</th>
  <th class="line-num">128</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">128</th>
  <th class="line-num">129</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">129</th>
  <th class="line-num">130</th>
  <td class="line-code ">
    <pre>  def test_version_if_condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">130</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = Page.create<span></span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">131</th>
  <td class="line-code diff_in">
    <pre>    p = Page.create<span>!</span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">131</th>
  <th class="line-num">132</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">132</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">133</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">133</th>
  <th class="line-num">134</th>
  <td class="line-code ">
    <pre>    Page.feeling_good = false
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">134</th>
  <th class="line-num">135</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">135</th>
  <th class="line-num">136</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">136</th>
  <th class="line-num">137</th>
  <td class="line-code ">
    <pre>    Page.feeling_good = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">137</th>
  <th class="line-num">138</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">138</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">139</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">139</th>
  <th class="line-num">140</th>
  <td class="line-code ">
    <pre>  def test_version_if_condition2
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">140</th>
  <th class="line-num">141</th>
  <td class="line-code ">
    <pre>    # set new if condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">141</th>
  <th class="line-num">142</th>
  <td class="line-code ">
    <pre>    Page.class_eval do
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">143</th>
  <th class="line-num">144</th>
  <td class="line-code ">
    <pre>      alias_method :old_feeling_good, :feeling_good?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">144</th>
  <th class="line-num">145</th>
  <td class="line-code ">
    <pre>      alias_method :feeling_good?, :new_feeling_good
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">145</th>
  <th class="line-num">146</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">146</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">147</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = Page.create<span></span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">147</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">148</th>
  <td class="line-code diff_in">
    <pre>    p = Page.create<span>!</span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">148</th>
  <th class="line-num">149</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version # version does not increment
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">149</th>
  <th class="line-num">150</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">150</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">151</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">151</th>
  <th class="line-num">152</th>
  <td class="line-code ">
    <pre>    p.update_attributes(:title =&gt; 'new title')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">152</th>
  <th class="line-num">153</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version # version does not increment
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">153</th>
  <th class="line-num">154</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">154</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">155</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">155</th>
  <th class="line-num">156</th>
  <td class="line-code ">
    <pre>    p.update_attributes(:title =&gt; 'a title')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">156</th>
  <th class="line-num">157</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">157</th>
  <th class="line-num">158</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">158</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">159</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">159</th>
  <th class="line-num">160</th>
  <td class="line-code ">
    <pre>    # reset original if condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">160</th>
  <th class="line-num">161</th>
  <td class="line-code ">
    <pre>    Page.class_eval { alias_method :feeling_good?, :old_feeling_good }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">161</th>
  <th class="line-num">162</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">162</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">163</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">163</th>
  <th class="line-num">164</th>
  <td class="line-code ">
    <pre>  def test_version_if_condition_with_block
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">164</th>
  <th class="line-num">165</th>
  <td class="line-code ">
    <pre>    # set new if condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">165</th>
  <th class="line-num">166</th>
  <td class="line-code ">
    <pre>    old_condition = Page.version_condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">166</th>
  <th class="line-num">167</th>
  <td class="line-code ">
    <pre>    Page.version_condition = Proc.new { |page| page.title[0..0] == 'b' }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">167</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">168</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = Page.create<span></span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">168</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">169</th>
  <td class="line-code diff_in">
    <pre>    p = Page.create<span>!</span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">169</th>
  <th class="line-num">170</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version # version does not increment
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">170</th>
  <th class="line-num">171</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">171</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">172</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">172</th>
  <th class="line-num">173</th>
  <td class="line-code ">
    <pre>    p.update_attributes(:title =&gt; 'a title')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">173</th>
  <th class="line-num">174</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.version # version does not increment
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">174</th>
  <th class="line-num">175</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">175</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">176</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">176</th>
  <th class="line-num">177</th>
  <td class="line-code ">
    <pre>    p.update_attributes(:title =&gt; 'b title')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">177</th>
  <th class="line-num">178</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">178</th>
  <th class="line-num">179</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">179</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">180</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">180</th>
  <th class="line-num">181</th>
  <td class="line-code ">
    <pre>    # reset original if condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">181</th>
  <th class="line-num">182</th>
  <td class="line-code ">
    <pre>    Page.version_condition = old_condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">182</th>
  <th class="line-num">183</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">183</th>
  <th class="line-num">184</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">184</th>
  <th class="line-num">185</th>
  <td class="line-code ">
    <pre>  def test_version_no_limit
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">185</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = Page.create<span></span> :title =&gt; &quot;title&quot;, :body =&gt; 'first body'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">186</th>
  <td class="line-code diff_in">
    <pre>    p = Page.create<span>!</span> :title =&gt; &quot;title&quot;, :body =&gt; 'first body'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">186</th>
  <th class="line-num">187</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">187</th>
  <th class="line-num">188</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">188</th>
  <th class="line-num">189</th>
  <td class="line-code ">
    <pre>    5.times do |i|
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">191</th>
  <th class="line-num">192</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">192</th>
  <th class="line-num">193</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">193</th>
  <th class="line-num">194</th>
  <td class="line-code ">
    <pre>  def test_version_max_limit
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">194</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = LockedPage.create<span></span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">195</th>
  <td class="line-code diff_in">
    <pre>    p = LockedPage.create<span>!</span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">195</th>
  <th class="line-num">196</th>
  <td class="line-code ">
    <pre>    p.update_attributes(:title =&gt; &quot;title1&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">196</th>
  <th class="line-num">197</th>
  <td class="line-code ">
    <pre>    p.update_attributes(:title =&gt; &quot;title2&quot;)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">197</th>
  <th class="line-num">198</th>
  <td class="line-code ">
    <pre>    5.times do |i|
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">199</th>
  <th class="line-num">200</th>
  <td class="line-code ">
    <pre>      assert p.versions(true).size &lt;= 2, &quot;locked version can only store 2 versions&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">200</th>
  <th class="line-num">201</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">201</th>
  <th class="line-num">202</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">202</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">203</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def test_track_<span>chang</span>ed_attributes_default_value
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">204</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert !Page.track_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">205</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert LockedPage.track_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">206</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert SpecialLockedPage.track_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">203</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">204</th>
  <td class="line-code diff_in">
    <pre>  def test_track_<span>alter</span>ed_attributes_default_value
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">205</th>
  <td class="line-code diff_in">
    <pre>    assert !Page.track_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">206</th>
  <td class="line-code diff_in">
    <pre>    assert LockedPage.track_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">207</th>
  <td class="line-code diff_in">
    <pre>    assert SpecialLockedPage.track_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">207</th>
  <th class="line-num">208</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">208</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">209</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">209</th>
  <th class="line-num">210</th>
  <td class="line-code ">
    <pre>  def test_version_order
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">210</th>
  <th class="line-num">211</th>
  <td class="line-code ">
    <pre>    assert_equal 23, pages(:welcome).versions.first.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">211</th>
  <th class="line-num">212</th>
  <td class="line-code ">
    <pre>    assert_equal 24, pages(:welcome).versions.last.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">212</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_equal 23, pages(:welcome).find_versions.first.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">213</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_equal 24, pages(:welcome).find_versions.last.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">214</th>
  <th class="line-num">213</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">215</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">216</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def test_track_<span>changed_attributes    </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">217</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    p = LockedPage.create<span></span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">214</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">215</th>
  <td class="line-code diff_in">
    <pre>  def test_track_<span>altered_attributes</span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">216</th>
  <td class="line-code diff_in">
    <pre>    p = LockedPage.create<span>!</span> :title =&gt; &quot;title&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">218</th>
  <th class="line-num">217</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.lock_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">219</th>
  <th class="line-num">218</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">220</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">219</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">221</th>
  <th class="line-num">220</th>
  <td class="line-code ">
    <pre>    p.title = 'title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">222</th>
  <th class="line-num">221</th>
  <td class="line-code ">
    <pre>    assert !p.save_version?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">223</th>
  <th class="line-num">222</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">224</th>
  <th class="line-num">223</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.lock_version # still increments version because of optimistic locking
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">225</th>
  <th class="line-num">224</th>
  <td class="line-code ">
    <pre>    assert_equal 1, p.versions(true).size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">226</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">225</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">227</th>
  <th class="line-num">226</th>
  <td class="line-code ">
    <pre>    p.title = 'updated title'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">228</th>
  <th class="line-num">227</th>
  <td class="line-code ">
    <pre>    assert p.save_version?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">229</th>
  <th class="line-num">228</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">236</th>
  <th class="line-num">235</th>
  <td class="line-code ">
    <pre>    assert_equal 4, p.lock_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">237</th>
  <th class="line-num">236</th>
  <td class="line-code ">
    <pre>    assert_equal 2, p.versions(true).size # version 1 deleted
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">238</th>
  <th class="line-num">237</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">239</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">238</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">240</th>
  <th class="line-num">239</th>
  <td class="line-code ">
    <pre>  def assert_page_title(p, i, version_field = :version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">241</th>
  <th class="line-num">240</th>
  <td class="line-code ">
    <pre>    p.title = &quot;title#{i}&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">242</th>
  <th class="line-num">241</th>
  <td class="line-code ">
    <pre>    p.save
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">243</th>
  <th class="line-num">242</th>
  <td class="line-code ">
    <pre>    assert_equal &quot;title#{i}&quot;, p.title
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">244</th>
  <th class="line-num">243</th>
  <td class="line-code ">
    <pre>    assert_equal (i+4), p.send(version_field)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">245</th>
  <th class="line-num">244</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">246</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">245</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">247</th>
  <th class="line-num">246</th>
  <td class="line-code ">
    <pre>  def test_find_versions
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">248</th>
  <th class="line-num">247</th>
  <td class="line-code ">
    <pre>    assert_equal 2, locked_pages(:welcome).versions.size
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">249</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_equal 1, locked_pages(:welcome).find_versions(:conditions =&gt; ['title LIKE ?', '%weblog%']).length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">250</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_equal 2, locked_pages(:welcome).find_versions(:conditions =&gt; ['title LIKE ?', '%web%']).length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">251</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_equal 0, locked_pages(:thinking).find_versions(:conditions =&gt; ['title LIKE ?', '%web%']).length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">252</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_equal 2, locked_pages(:welcome).find_versions.length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">248</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 1, locked_pages(:welcome).versions.find(:all, :conditions =&gt; ['title LIKE ?', '%weblog%']).length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">249</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 2, locked_pages(:welcome).versions.find(:all, :conditions =&gt; ['title LIKE ?', '%web%']).length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">250</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 0, locked_pages(:thinking).versions.find(:all, :conditions =&gt; ['title LIKE ?', '%web%']).length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">251</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 2, locked_pages(:welcome).versions.length
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">252</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">253</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">254</th>
  <td class="line-code diff_in">
    <pre>  def test_find_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">255</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_1), Page.find_version(pages(:welcome).id, 23)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">256</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_2), Page.find_version(pages(:welcome).id, 24)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">257</th>
  <td class="line-code diff_in">
    <pre>    assert_equal pages(:welcome), Page.find_version(pages(:welcome).id)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">258</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">259</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_1), pages(:welcome).find_version(23)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">260</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_2), pages(:welcome).find_version(24)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">261</th>
  <td class="line-code diff_in">
    <pre>    assert_equal pages(:welcome), pages(:welcome).find_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">262</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">263</th>
  <td class="line-code diff_in">
    <pre>    assert_raise(ActiveRecord::RecordNotFound) { Page.find_version(pages(:welcome).id, 1) }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">264</th>
  <td class="line-code diff_in">
    <pre>    assert_raise(ActiveRecord::RecordNotFound) { Page.find_version(0, 23) }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">253</th>
  <th class="line-num">265</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">254</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">266</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">255</th>
  <th class="line-num">267</th>
  <td class="line-code ">
    <pre>  def test_with_sequence
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">256</th>
  <th class="line-num">268</th>
  <td class="line-code ">
    <pre>    assert_equal 'widgets_seq', Widget.versioned_class.sequence_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">257</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    Widget.create :name =&gt; 'new widget'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">258</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    Widget.create :name =&gt; 'new widget'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">259</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    Widget.create :name =&gt; 'new widget'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">269</th>
  <td class="line-code diff_in">
    <pre>    3.times { Widget.create! :name =&gt; 'new widget' }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">260</th>
  <th class="line-num">270</th>
  <td class="line-code ">
    <pre>    assert_equal 3, Widget.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">261</th>
  <th class="line-num">271</th>
  <td class="line-code ">
    <pre>    assert_equal 3, Widget.versioned_class.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">262</th>
  <th class="line-num">272</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">268</th>
  <th class="line-num">278</th>
  <td class="line-code ">
    <pre>  def test_has_many_through_with_custom_association
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">269</th>
  <th class="line-num">279</th>
  <td class="line-code ">
    <pre>    assert_equal [authors(:caged), authors(:mly)], pages(:welcome).revisors
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">270</th>
  <th class="line-num">280</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">271</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">281</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">272</th>
  <th class="line-num">282</th>
  <td class="line-code ">
    <pre>  def test_referential_integrity
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">273</th>
  <th class="line-num">283</th>
  <td class="line-code ">
    <pre>    pages(:welcome).destroy
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">274</th>
  <th class="line-num">284</th>
  <td class="line-code ">
    <pre>    assert_equal 0, Page.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">275</th>
  <th class="line-num">285</th>
  <td class="line-code ">
    <pre>    assert_equal 0, Page::Version.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">276</th>
  <th class="line-num">286</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">277</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">287</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">278</th>
  <th class="line-num">288</th>
  <td class="line-code ">
    <pre>  def test_association_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">279</th>
  <th class="line-num">289</th>
  <td class="line-code ">
    <pre>    association = Page.reflect_on_association(:versions)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">280</th>
  <th class="line-num">290</th>
  <td class="line-code ">
    <pre>    options = association.options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">281</th>
  <th class="line-num">291</th>
  <td class="line-code ">
    <pre>    assert_equal :delete_all, options[:dependent]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">282</th>
  <th class="line-num">292</th>
  <td class="line-code ">
    <pre>    assert_equal 'version', options[:order]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">283</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">293</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">284</th>
  <th class="line-num">294</th>
  <td class="line-code ">
    <pre>    association = Widget.reflect_on_association(:versions)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">285</th>
  <th class="line-num">295</th>
  <td class="line-code ">
    <pre>    options = association.options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">286</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    assert_<span>nil</span> options[:dependent]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">296</th>
  <td class="line-code diff_in">
    <pre>    assert_<span>equal :nullify,</span> options[:dependent]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">287</th>
  <th class="line-num">297</th>
  <td class="line-code ">
    <pre>    assert_equal 'version desc', options[:order]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">288</th>
  <th class="line-num">298</th>
  <td class="line-code ">
    <pre>    assert_equal 'widget_id', options[:foreign_key]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">289</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">290</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    widget = Widget.create<span></span> :name =&gt; 'new widget'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">299</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">300</th>
  <td class="line-code diff_in">
    <pre>    widget = Widget.create<span>!</span> :name =&gt; 'new widget'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">291</th>
  <th class="line-num">301</th>
  <td class="line-code ">
    <pre>    assert_equal 1, Widget.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">292</th>
  <th class="line-num">302</th>
  <td class="line-code ">
    <pre>    assert_equal 1, Widget.versioned_class.count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">293</th>
  <th class="line-num">303</th>
  <td class="line-code ">
    <pre>    widget.destroy
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">300</th>
  <th class="line-num">310</th>
  <td class="line-code ">
    <pre>    page_version = page.versions.last
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">301</th>
  <th class="line-num">311</th>
  <td class="line-code ">
    <pre>    assert_equal page, page_version.page
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">302</th>
  <th class="line-num">312</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">303</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">304</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  def test_un<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">305</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    landmarks(:washington).attributes = landmarks(:washington).attributes<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">313</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">314</th>
  <td class="line-code diff_in">
    <pre>  def test_un<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">315</th>
  <td class="line-code diff_in">
    <pre>    landmarks(:washington).attributes = landmarks(:washington).attributes<span>.except(&quot;id&quot;)</span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">306</th>
  <th class="line-num">316</th>
  <td class="line-code ">
    <pre>    assert !landmarks(:washington).changed?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">307</th>
  <th class="line-num">317</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">308</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">318</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">309</th>
  <th class="line-num">319</th>
  <td class="line-code ">
    <pre>  def test_unchanged_string_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">310</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    landmarks(:washington).attributes = landmarks(:washington).attributes.<span>inject({}) { |params, (key, value)| params.update key =&gt; value.to_s</span> }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">320</th>
  <td class="line-code diff_in">
    <pre>    landmarks(:washington).attributes = landmarks(:washington).attributes.<span>except(&quot;id&quot;).inject({}) { |params, (key, value)| params.update(key =&gt; value.to_s)</span> }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">311</th>
  <th class="line-num">321</th>
  <td class="line-code ">
    <pre>    assert !landmarks(:washington).changed?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">312</th>
  <th class="line-num">322</th>
  <td class="line-code ">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">313</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">323</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">324</th>
  <td class="line-code diff_in">
    <pre>  def test_should_find_earliest_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">325</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_1), pages(:welcome).versions.earliest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">326</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">327</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">328</th>
  <td class="line-code diff_in">
    <pre>  def test_should_find_latest_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">329</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_2), pages(:welcome).versions.latest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">330</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">331</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">332</th>
  <td class="line-code diff_in">
    <pre>  def test_should_find_previous_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">333</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_1), page_versions(:welcome_2).previous
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">334</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_1), pages(:welcome).versions.before(page_versions(:welcome_2))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">335</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">336</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">337</th>
  <td class="line-code diff_in">
    <pre>  def test_should_find_next_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">338</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_2), page_versions(:welcome_1).next
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">339</th>
  <td class="line-code diff_in">
    <pre>    assert_equal page_versions(:welcome_2), pages(:welcome).versions.after(page_versions(:welcome_1))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">340</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">341</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">342</th>
  <td class="line-code diff_in">
    <pre>  def test_should_find_version_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">343</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 24, pages(:welcome).versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">344</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 24, page_versions(:welcome_1).versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">345</th>
  <td class="line-code diff_in">
    <pre>    assert_equal 24, page_versions(:welcome_2).versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">346</th>
  <td class="line-code diff_in">
    <pre>  end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">347</th>
  <td class="line-code diff_in">
    <pre>end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/rfpdf/init.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">1</th>
  <th class="line-num">1</th>
  <td class="line-code ">
    <pre>require 'rfpdf'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">2</th>
  <th class="line-num">2</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">3</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>ActionView::Base::register_template_handler 'rfpdf', RFPDF::View
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">3</th>
  <td class="line-code diff_in">
    <pre>begin
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">4</th>
  <td class="line-code diff_in">
    <pre>  ActionView::Template::register_template_handler 'rfpdf', RFPDF::View
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">5</th>
  <td class="line-code diff_in">
    <pre>rescue NameError
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">6</th>
  <td class="line-code diff_in">
    <pre>  # Rails &lt; 2.1
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">7</th>
  <td class="line-code diff_in">
    <pre>  RFPDF::View.backward_compatibility_mode = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">8</th>
  <td class="line-code diff_in">
    <pre>  ActionView::Base::register_template_handler 'rfpdf', RFPDF::View
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">9</th>
  <td class="line-code diff_in">
    <pre>end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/rfpdf/lib/rfpdf/view.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">30</th>
  <th class="line-num">30</th>
  <td class="line-code ">
    <pre>module RFPDF
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">31</th>
  <th class="line-num">31</th>
  <td class="line-code ">
    <pre>  
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">32</th>
  <th class="line-num">32</th>
  <td class="line-code ">
    <pre>  class View
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">33</th>
  <td class="line-code diff_in">
    <pre>    @@backward_compatibility_mode = false
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">34</th>
  <td class="line-code diff_in">
    <pre>    cattr_accessor :backward_compatibility_mode
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">33</th>
  <th class="line-num">35</th>
  <td class="line-code ">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">34</th>
  <th class="line-num">36</th>
  <td class="line-code ">
    <pre>    def initialize(action_view)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">35</th>
  <th class="line-num">37</th>
  <td class="line-code ">
    <pre>      @action_view = action_view
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">45</th>
  <th class="line-num">47</th>
  <td class="line-code ">
    <pre>        :temp_dir =&gt; &quot;#{File.expand_path(RAILS_ROOT)}/tmp&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">46</th>
  <th class="line-num">48</th>
  <td class="line-code ">
    <pre>      }.merge(@action_view.controller.instance_eval{ @options_for_rfpdf } || {}).with_indifferent_access
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">47</th>
  <th class="line-num">49</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">50</th>
  <td class="line-code diff_in">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">51</th>
  <td class="line-code diff_in">
    <pre>    def self.compilable?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">52</th>
  <td class="line-code diff_in">
    <pre>      false
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">53</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">54</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">55</th>
  <td class="line-code diff_in">
    <pre>    def compilable?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">56</th>
  <td class="line-code diff_in">
    <pre>      self.class.compilable?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">57</th>
  <td class="line-code diff_in">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">48</th>
  <th class="line-num">58</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">49</th>
  <th class="line-num">59</th>
  <td class="line-code ">
    <pre>    def render(template, local_assigns = {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">50</th>
  <th class="line-num">60</th>
  <td class="line-code ">
    <pre>			@pdf_name = &quot;Default.pdf&quot; if @pdf_name.nil?
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">66</th>
  <th class="line-num">76</th>
  <td class="line-code ">
    <pre>			  local_assigns.each do |key,val|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">67</th>
  <th class="line-num">77</th>
  <td class="line-code ">
    <pre>		  		class &lt;&lt; self; self; end.send(:define_method,key){ val }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">68</th>
  <th class="line-num">78</th>
  <td class="line-code ">
    <pre>				end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">69</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        ERB.new(<span>template).result(binding)</span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">79</th>
  <td class="line-code diff_in">
    <pre>        ERB.new(<span>@@backward_compatibility_mode == true ? template : template.source).result(binding) </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">70</th>
  <th class="line-num">80</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">71</th>
  <th class="line-num">81</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">72</th>
  <th class="line-num">82</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>
</tbody>
</table>
</div>




<p class="other-formats">(Other formats not available in this archive.</p>




        
        <div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>

<!-- Mirrored from redmine.ogf.org/projects/redmine-og/repository/revisions/7cdd88a6ce3632c801223b33e5ccc2b9fc13651e/diff by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Sep 2022 22:40:21 GMT -->
</html>
