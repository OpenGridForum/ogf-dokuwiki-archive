<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!-- Mirrored from redmine.ogf.org/projects/redmine-og/repository/revisions/7cdd88a6ce3632c801223b33e5ccc2b9fc13651e/diff/vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Sep 2022 22:40:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>/vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb - Diff - Redmine - Open Grid Forum</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token"/>
<meta name="csrf-token" content="7RiXtn8JMoxXZTBSrtL64n0O2gGmxf69GTM4qjOvQSI="/>
<link rel='shortcut icon' href='https://redmine.ogf.org/favicon.ico?1425381960' />
<link href="https://redmine.ogf.org/themes/ogf_redmine/stylesheets/application.css?1425381960" media="all" rel="stylesheet" type="text/css" />

<script src="https://redmine.ogf.org/javascripts/prototype.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/effects.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/dragdrop.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/controls.js?1425381960" type="text/javascript"></script>
<script src="https://redmine.ogf.org/javascripts/application.js?1425381960" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
Event.observe(window, 'load', function(){ new WarnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>

<!--[if IE 6]>
    <style type="text/css">
      * html body{ width: expression( document.documentElement.clientWidth < 900 ? '900px' : '100%' ); }
      body {behavior: url(/stylesheets/csshover.htc?1425381960);}
    </style>
<![endif]-->
<link href="https://redmine.ogf.org/plugin_assets/extended_fields/stylesheets/extended_fields.css?1425381960" media="screen" rel="stylesheet" type="text/css" /> <link href="https://redmine.ogf.org/plugin_assets/wiking/stylesheets/wiking.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->

<link href="https://redmine.ogf.org/stylesheets/scm.css?1425381960" media="screen" rel="stylesheet" type="text/css" />
</head>
<body class="theme-Ogf redmine controller-repositories action-diff">
<div id="wrapper">
<div id="wrapper2">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="https://redmine.ogf.org/login" class="login">Login</a></li>
<li><a href="https://redmine.ogf.org/account/register" class="register">Register</a></li></ul>    </div>
    
    <ul><li><a href="https://redmine.ogf.org/" class="home">Home</a></li>
<li><a href="https://redmine.ogf.org/projects" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    
    <div id="quick-search">
        <form action="https://redmine.ogf.org/search/index/redmine-og" method="get">
        <input name="changesets" type="hidden" value="1" />
        <label for='q'>
          <a href="https://redmine.ogf.org/search/index/redmine-og" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
        </form>
        
    </div>
    

    <h1><a href="https://redmine.ogf.org/projects/operations?jump=repository" class="root">Operations</a> » <a href="https://redmine.ogf.org/projects/it-og?jump=repository" class="ancestor">IT</a> » Redmine</h1>

    
    <div id="main-menu">
        <ul><li><a href="https://redmine.ogf.org/projects/redmine-og" class="overview">Overview</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/issues" class="issues">Issues</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/issues/calendar" class="calendar">Calendar</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/news" class="news">News</a></li>
<li><a href="https://redmine.ogf.org/dmsf/redmine-og" class="dmsf">Documents</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/wiki" class="wiki">Wiki</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/files" class="files">Files</a></li>
<li><a href="https://redmine.ogf.org/projects/redmine-og/repository" class="repository selected">Repository</a></li></ul>
    </div>
    
</div>

<div class="nosidebar" id="main">
    <div id="sidebar">
        
        
  
  


    </div>

    <div id="content">
        
        <h2>Revision 7cdd88a6 vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb</h2>

<!-- Choose view type -->
<form action="https://redmine.ogf.org/projects/redmine-og/repository/diff/vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb" method="get">
  <input id="rev" name="rev" type="hidden" value="7cdd88a6ce3632c801223b33e5ccc2b9fc13651e" />
  
  <p>
    <label>View differences</label>
    <select id="type" name="type" onchange="if (this.value != '') {this.form.submit()}"><option value="inline" selected="selected">inline</option>
<option value="sbs">side by side</option></select>
  </p>
</form>


<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      b/vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb
    </th>
  </tr>
</thead>
<tbody>

<tr>
  <th class="line-num">22</th>
  <th class="line-num">22</th>
  <td class="line-code ">
    <pre>module ActiveRecord #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">23</th>
  <th class="line-num">23</th>
  <td class="line-code ">
    <pre>  module Acts #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">24</th>
  <th class="line-num">24</th>
  <td class="line-code ">
    <pre>    # Specify this act if you want to save a copy of the row in a versioned table.  This assumes there is a 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">25</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    # versioned table ready and that your model has a version field.  This works with optimis<span></span>ic locking if the lock_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">25</th>
  <td class="line-code diff_in">
    <pre>    # versioned table ready and that your model has a version field.  This works with optimis<span>t</span>ic locking if the lock_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">26</th>
  <th class="line-num">26</th>
  <td class="line-code ">
    <pre>    # column is present as well.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">27</th>
  <th class="line-num">27</th>
  <td class="line-code ">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">28</th>
  <th class="line-num">28</th>
  <td class="line-code ">
    <pre>    # The class for the versioned model is derived the first time it is seen. Therefore, if you change your database schema you have to restart
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">49</th>
  <th class="line-num">49</th>
  <td class="line-code ">
    <pre>    #   page.revert_to(page.versions.last) # using versioned instance
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">50</th>
  <th class="line-num">50</th>
  <td class="line-code ">
    <pre>    #   page.title         # =&gt; 'hello world'
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">51</th>
  <th class="line-num">51</th>
  <td class="line-code ">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">52</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.earliest # efficient query to find the first version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">53</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.latest   # efficient query to find the most recently created version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">54</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">55</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">56</th>
  <td class="line-code diff_in">
    <pre>    # Simple Queries to page between versions
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">57</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">58</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.before(version) 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">59</th>
  <td class="line-code diff_in">
    <pre>    #   page.versions.after(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">60</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">61</th>
  <td class="line-code diff_in">
    <pre>    # Access the previous/next versions from the versioned model itself
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">62</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">63</th>
  <td class="line-code diff_in">
    <pre>    #   version = page.versions.latest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">64</th>
  <td class="line-code diff_in">
    <pre>    #   version.previous # go back one version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">65</th>
  <td class="line-code diff_in">
    <pre>    #   version.next     # go forward one version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">66</th>
  <td class="line-code diff_in">
    <pre>    #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">52</th>
  <th class="line-num">67</th>
  <td class="line-code ">
    <pre>    # See ActiveRecord::Acts::Versioned::ClassMethods#acts_as_versioned for configuration options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">53</th>
  <th class="line-num">68</th>
  <td class="line-code ">
    <pre>    module Versioned
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">54</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>      CALLBACKS = [:set_new_version, :save_version_on_create, :save_version?, :clear_<span>chang</span>ed_attributes]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">69</th>
  <td class="line-code diff_in">
    <pre>      CALLBACKS = [:set_new_version, :save_version_on_create, :save_version?, :clear_<span>alter</span>ed_attributes]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">55</th>
  <th class="line-num">70</th>
  <td class="line-code ">
    <pre>      def self.included(base) # :nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">56</th>
  <th class="line-num">71</th>
  <td class="line-code ">
    <pre>        base.extend ClassMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">57</th>
  <th class="line-num">72</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">80</th>
  <th class="line-num">95</th>
  <td class="line-code ">
    <pre>        #     end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">81</th>
  <th class="line-num">96</th>
  <td class="line-code ">
    <pre>        #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">82</th>
  <th class="line-num">97</th>
  <td class="line-code ">
    <pre>        # * &lt;tt&gt;if_changed&lt;/tt&gt; - Simple way of specifying attributes that are required to be changed before saving a model.  This takes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">83</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        #   either a symbol or array of symbols.  WARNING - This will attempt to overwrite any attribute setters you may have.<span>  </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">98</th>
  <td class="line-code diff_in">
    <pre>        #   either a symbol or array of symbols.  WARNING - This will attempt to overwrite any attribute setters you may have.<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">84</th>
  <th class="line-num">99</th>
  <td class="line-code ">
    <pre>        #   Use this instead if you want to write your own attribute setters (and ignore if_changed):
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">85</th>
  <th class="line-num">100</th>
  <td class="line-code ">
    <pre>        # 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">86</th>
  <th class="line-num">101</th>
  <td class="line-code ">
    <pre>        #     def name=(new_name)
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">133</th>
  <th class="line-num">148</th>
  <td class="line-code ">
    <pre>        #       # that create_table does
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">134</th>
  <th class="line-num">149</th>
  <td class="line-code ">
    <pre>        #       Post.create_versioned_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">135</th>
  <th class="line-num">150</th>
  <td class="line-code ">
    <pre>        #     end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">136</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # <span>  </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">151</th>
  <td class="line-code diff_in">
    <pre>        # <span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">137</th>
  <th class="line-num">152</th>
  <td class="line-code ">
    <pre>        #     def self.down
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">138</th>
  <th class="line-num">153</th>
  <td class="line-code ">
    <pre>        #       Post.drop_versioned_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">139</th>
  <th class="line-num">154</th>
  <td class="line-code ">
    <pre>        #     end
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">157</th>
  <th class="line-num">172</th>
  <td class="line-code ">
    <pre>          return if self.included_modules.include?(ActiveRecord::Acts::Versioned::ActMethods)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">158</th>
  <th class="line-num">173</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">159</th>
  <th class="line-num">174</th>
  <td class="line-code ">
    <pre>          send :include, ActiveRecord::Acts::Versioned::ActMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">160</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">175</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">161</th>
  <th class="line-num">176</th>
  <td class="line-code ">
    <pre>          cattr_accessor :versioned_class_name, :versioned_foreign_key, :versioned_table_name, :versioned_inheritance_column, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">162</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            :version_column, :max_version_limit, :track_<span>chang</span>ed_attributes, :version_condition, :version_sequence_name, :non_versioned_columns,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">177</th>
  <td class="line-code diff_in">
    <pre>            :version_column, :max_version_limit, :track_<span>alter</span>ed_attributes, :version_condition, :version_sequence_name, :non_versioned_columns,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">163</th>
  <th class="line-num">178</th>
  <td class="line-code ">
    <pre>            :version_association_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">164</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">179</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">165</th>
  <th class="line-num">180</th>
  <td class="line-code ">
    <pre>          # legacy
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">166</th>
  <th class="line-num">181</th>
  <td class="line-code ">
    <pre>          alias_method :non_versioned_fields,  :non_versioned_columns
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">167</th>
  <th class="line-num">182</th>
  <td class="line-code ">
    <pre>          alias_method :non_versioned_fields=, :non_versioned_columns=
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">171</th>
  <th class="line-num">186</th>
  <td class="line-code ">
    <pre>            alias_method :non_versioned_fields=, :non_versioned_columns=
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">172</th>
  <th class="line-num">187</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">173</th>
  <th class="line-num">188</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">174</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          send :attr_accessor, :<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">189</th>
  <td class="line-code diff_in">
    <pre>          send :attr_accessor, :<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">175</th>
  <th class="line-num">190</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">176</th>
  <th class="line-num">191</th>
  <td class="line-code ">
    <pre>          self.versioned_class_name         = options[:class_name]  || &quot;Version&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">177</th>
  <th class="line-num">192</th>
  <td class="line-code ">
    <pre>          self.versioned_foreign_key        = options[:foreign_key] || self.to_s.foreign_key
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">184</th>
  <th class="line-num">199</th>
  <td class="line-code ">
    <pre>          self.non_versioned_columns        = [self.primary_key, inheritance_column, 'version', 'lock_version', versioned_inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">185</th>
  <th class="line-num">200</th>
  <td class="line-code ">
    <pre>          self.version_association_options  = {
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">186</th>
  <th class="line-num">201</th>
  <td class="line-code ">
    <pre>                                                :class_name  =&gt; &quot;#{self.to_s}::#{versioned_class_name}&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">187</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                                                :foreign_key =&gt; &quot;#{versioned_foreign_key}&quot;,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">188</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                                                :order       =&gt; 'version',
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">202</th>
  <td class="line-code diff_in">
    <pre>                                                :foreign_key =&gt; versioned_foreign_key,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">189</th>
  <th class="line-num">203</th>
  <td class="line-code ">
    <pre>                                                :dependent   =&gt; :delete_all
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">190</th>
  <th class="line-num">204</th>
  <td class="line-code ">
    <pre>                                              }.merge(options[:association_options] || {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">191</th>
  <th class="line-num">205</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">194</th>
  <th class="line-num">208</th>
  <td class="line-code ">
    <pre>            silence_warnings do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">195</th>
  <th class="line-num">209</th>
  <td class="line-code ">
    <pre>              self.const_set(extension_module_name, Module.new(&amp;extension))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">196</th>
  <th class="line-num">210</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">197</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">211</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">198</th>
  <th class="line-num">212</th>
  <td class="line-code ">
    <pre>            options[:extend] = self.const_get(extension_module_name)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">199</th>
  <th class="line-num">213</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">200</th>
  <th class="line-num">214</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">201</th>
  <th class="line-num">215</th>
  <td class="line-code ">
    <pre>          class_eval do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">202</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            has_many :versions, version_association_options
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">216</th>
  <td class="line-code diff_in">
    <pre>            has_many :versions, version_association_options do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">217</th>
  <td class="line-code diff_in">
    <pre>              # finds earliest version of this record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">218</th>
  <td class="line-code diff_in">
    <pre>              def earliest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">219</th>
  <td class="line-code diff_in">
    <pre>                @earliest ||= find(:first, :order =&gt; 'version')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">220</th>
  <td class="line-code diff_in">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">221</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">222</th>
  <td class="line-code diff_in">
    <pre>              # find latest version of this record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">223</th>
  <td class="line-code diff_in">
    <pre>              def latest
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">224</th>
  <td class="line-code diff_in">
    <pre>                @latest ||= find(:first, :order =&gt; 'version desc')
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">225</th>
  <td class="line-code diff_in">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">226</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">203</th>
  <th class="line-num">227</th>
  <td class="line-code ">
    <pre>            before_save  :set_new_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">204</th>
  <th class="line-num">228</th>
  <td class="line-code ">
    <pre>            after_create :save_version_on_create
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">205</th>
  <th class="line-num">229</th>
  <td class="line-code ">
    <pre>            after_update :save_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">206</th>
  <th class="line-num">230</th>
  <td class="line-code ">
    <pre>            after_save   :clear_old_versions
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">207</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            after_save   :clear_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">208</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">231</th>
  <td class="line-code diff_in">
    <pre>            after_save   :clear_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">232</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">209</th>
  <th class="line-num">233</th>
  <td class="line-code ">
    <pre>            unless options[:if_changed].nil?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">210</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              self.track_<span>chang</span>ed_attributes = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">234</th>
  <td class="line-code diff_in">
    <pre>              self.track_<span>alter</span>ed_attributes = true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">211</th>
  <th class="line-num">235</th>
  <td class="line-code ">
    <pre>              options[:if_changed] = [options[:if_changed]] unless options[:if_changed].is_a?(Array)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">212</th>
  <th class="line-num">236</th>
  <td class="line-code ">
    <pre>              options[:if_changed].each do |attr_name|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">213</th>
  <th class="line-num">237</th>
  <td class="line-code ">
    <pre>                define_method(&quot;#{attr_name}=&quot;) do |value|
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">215</th>
  <th class="line-num">239</th>
  <td class="line-code ">
    <pre>                end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">216</th>
  <th class="line-num">240</th>
  <td class="line-code ">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">217</th>
  <th class="line-num">241</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">218</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">242</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">219</th>
  <th class="line-num">243</th>
  <td class="line-code ">
    <pre>            include options[:extend] if options[:extend].is_a?(Module)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">220</th>
  <th class="line-num">244</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">221</th>
  <th class="line-num">245</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">222</th>
  <th class="line-num">246</th>
  <td class="line-code ">
    <pre>          # create the dynamic versioned model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">223</th>
  <th class="line-num">247</th>
  <td class="line-code ">
    <pre>          const_set(versioned_class_name, Class.new(ActiveRecord::Base)).class_eval do
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">224</th>
  <th class="line-num">248</th>
  <td class="line-code ">
    <pre>            def self.reloadable? ; false ; end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">249</th>
  <td class="line-code diff_in">
    <pre>            # find first version before the given version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">250</th>
  <td class="line-code diff_in">
    <pre>            def self.before(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">251</th>
  <td class="line-code diff_in">
    <pre>              find :first, :order =&gt; 'version desc',
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">252</th>
  <td class="line-code diff_in">
    <pre>                :conditions =&gt; [&quot;#{original_class.versioned_foreign_key} = ? and version &lt; ?&quot;, version.send(original_class.versioned_foreign_key), version.version]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">253</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">254</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">255</th>
  <td class="line-code diff_in">
    <pre>            # find first version after the given version.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">256</th>
  <td class="line-code diff_in">
    <pre>            def self.after(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">257</th>
  <td class="line-code diff_in">
    <pre>              find :first, :order =&gt; 'version',
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">258</th>
  <td class="line-code diff_in">
    <pre>                :conditions =&gt; [&quot;#{original_class.versioned_foreign_key} = ? and version &gt; ?&quot;, version.send(original_class.versioned_foreign_key), version.version]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">259</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">260</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">261</th>
  <td class="line-code diff_in">
    <pre>            def previous
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">262</th>
  <td class="line-code diff_in">
    <pre>              self.class.before(self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">263</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">264</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">265</th>
  <td class="line-code diff_in">
    <pre>            def next
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">266</th>
  <td class="line-code diff_in">
    <pre>              self.class.after(self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">267</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">268</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">269</th>
  <td class="line-code diff_in">
    <pre>            def versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">270</th>
  <td class="line-code diff_in">
    <pre>              page.version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">271</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">225</th>
  <th class="line-num">272</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">226</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">273</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">274</th>
  <td class="line-code diff_in">
    <pre>          versioned_class.cattr_accessor :original_class
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">275</th>
  <td class="line-code diff_in">
    <pre>          versioned_class.original_class = self
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">227</th>
  <th class="line-num">276</th>
  <td class="line-code ">
    <pre>          versioned_class.set_table_name versioned_table_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">228</th>
  <th class="line-num">277</th>
  <td class="line-code ">
    <pre>          versioned_class.belongs_to self.to_s.demodulize.underscore.to_sym, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">229</th>
  <th class="line-num">278</th>
  <td class="line-code ">
    <pre>            :class_name  =&gt; &quot;::#{self.to_s}&quot;, 
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">232</th>
  <th class="line-num">281</th>
  <td class="line-code ">
    <pre>          versioned_class.set_sequence_name version_sequence_name if version_sequence_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">233</th>
  <th class="line-num">282</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">234</th>
  <th class="line-num">283</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">235</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">284</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">236</th>
  <th class="line-num">285</th>
  <td class="line-code ">
    <pre>      module ActMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">237</th>
  <th class="line-num">286</th>
  <td class="line-code ">
    <pre>        def self.included(base) # :nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">238</th>
  <th class="line-num">287</th>
  <td class="line-code ">
    <pre>          base.extend ClassMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">239</th>
  <th class="line-num">288</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">240</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">289</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">290</th>
  <td class="line-code diff_in">
    <pre>        # Finds a specific version of this record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">291</th>
  <td class="line-code diff_in">
    <pre>        def find_version(version = nil)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">292</th>
  <td class="line-code diff_in">
    <pre>          self.class.find_version(id, version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">293</th>
  <td class="line-code diff_in">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">294</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">241</th>
  <th class="line-num">295</th>
  <td class="line-code ">
    <pre>        # Saves a version of the model if applicable
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">242</th>
  <th class="line-num">296</th>
  <td class="line-code ">
    <pre>        def save_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">243</th>
  <th class="line-num">297</th>
  <td class="line-code ">
    <pre>          save_version_on_create if save_version?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">244</th>
  <th class="line-num">298</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">245</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">299</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">246</th>
  <th class="line-num">300</th>
  <td class="line-code ">
    <pre>        # Saves a version of the model in the versioned table.  This is called in the after_save callback by default
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">247</th>
  <th class="line-num">301</th>
  <td class="line-code ">
    <pre>        def save_version_on_create
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">248</th>
  <th class="line-num">302</th>
  <td class="line-code ">
    <pre>          rev = self.class.versioned_class.new
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">263</th>
  <th class="line-num">317</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">264</th>
  <th class="line-num">318</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">265</th>
  <th class="line-num">319</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">266</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # Finds a specific version of this model.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">267</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        def find_version(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">268</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          return version if version.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">269</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          return nil if version.is_a?(ActiveRecord::Base)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">270</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          find_versions(:conditions =&gt; ['version = ?', version], :limit =&gt; 1).first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">271</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">272</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">273</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # Finds versions of this model.  Takes an options hash like &lt;tt&gt;find&lt;/tt&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">274</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        def find_versions(options = {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">275</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          versions.find(:all, options)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">320</th>
  <td class="line-code diff_in">
    <pre>        def versions_count
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">321</th>
  <td class="line-code diff_in">
    <pre>          version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">276</th>
  <th class="line-num">322</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">277</th>
  <th class="line-num">323</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">278</th>
  <th class="line-num">324</th>
  <td class="line-code ">
    <pre>        # Reverts a model to a given version.  Takes either a version number or an instance of the versioned model
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">280</th>
  <th class="line-num">326</th>
  <td class="line-code ">
    <pre>          if version.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">281</th>
  <th class="line-num">327</th>
  <td class="line-code ">
    <pre>            return false unless version.send(self.class.versioned_foreign_key) == self.id and !version.new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">282</th>
  <th class="line-num">328</th>
  <td class="line-code ">
    <pre>          else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">283</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false unless version = <span>find</span>_version(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">329</th>
  <td class="line-code diff_in">
    <pre>            return false unless version = <span>versions.find_by</span>_version(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">284</th>
  <th class="line-num">330</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">285</th>
  <th class="line-num">331</th>
  <td class="line-code ">
    <pre>          self.clone_versioned_model(version, self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">286</th>
  <th class="line-num">332</th>
  <td class="line-code ">
    <pre>          self.send(&quot;#{self.class.version_column}=&quot;, version.version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">287</th>
  <th class="line-num">333</th>
  <td class="line-code ">
    <pre>          true
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">288</th>
  <th class="line-num">334</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">289</th>
  <th class="line-num">335</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">290</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        # Reverts a model to a given version and saves the model.<span>  </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">336</th>
  <td class="line-code diff_in">
    <pre>        # Reverts a model to a given version and saves the model.<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">291</th>
  <th class="line-num">337</th>
  <td class="line-code ">
    <pre>        # Takes either a version number or an instance of the versioned model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">292</th>
  <th class="line-num">338</th>
  <td class="line-code ">
    <pre>        def revert_to!(version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">293</th>
  <th class="line-num">339</th>
  <td class="line-code ">
    <pre>          revert_to(version) ? save_without_revision : false
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">313</th>
  <th class="line-num">359</th>
  <td class="line-code ">
    <pre>        def versioned_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">314</th>
  <th class="line-num">360</th>
  <td class="line-code ">
    <pre>          self.attributes.keys.select { |k| !self.class.non_versioned_columns.include?(k) }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">315</th>
  <th class="line-num">361</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">316</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">362</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">317</th>
  <th class="line-num">363</th>
  <td class="line-code ">
    <pre>        # If called with no parameters, gets whether the current model has changed and needs to be versioned.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">318</th>
  <th class="line-num">364</th>
  <td class="line-code ">
    <pre>        # If called with a single parameter, gets whether the parameter has changed.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">319</th>
  <th class="line-num">365</th>
  <td class="line-code ">
    <pre>        def changed?(attr_name = nil)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">320</th>
  <th class="line-num">366</th>
  <td class="line-code ">
    <pre>          attr_name.nil? ?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">321</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            (!self.class.track_<span>changed_attributes || (changed_attributes &amp;&amp; chang</span>ed_attributes.length &gt; 0)) :
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">322</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            (<span>changed_attributes &amp;&amp; chang</span>ed_attributes.include?(attr_name.to_s))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">367</th>
  <td class="line-code diff_in">
    <pre>            (!self.class.track_<span>altered_attributes || (altered_attributes &amp;&amp; alter</span>ed_attributes.length &gt; 0)) :
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">368</th>
  <td class="line-code diff_in">
    <pre>            (<span>altered_attributes &amp;&amp; alter</span>ed_attributes.include?(attr_name.to_s))
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">323</th>
  <th class="line-num">369</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">324</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">370</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">325</th>
  <th class="line-num">371</th>
  <td class="line-code ">
    <pre>        # keep old dirty? method
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">326</th>
  <th class="line-num">372</th>
  <td class="line-code ">
    <pre>        alias_method :dirty?, :changed?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">327</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">373</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">328</th>
  <th class="line-num">374</th>
  <td class="line-code ">
    <pre>        # Clones a model.  Used when saving a new version or reverting a model's version.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">329</th>
  <th class="line-num">375</th>
  <td class="line-code ">
    <pre>        def clone_versioned_model(orig_model, new_model)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">330</th>
  <th class="line-num">376</th>
  <td class="line-code ">
    <pre>          self.versioned_attributes.each do |key|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">331</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            new_model.send(&quot;#{key}=&quot;, orig_model.<span>attributes[key]</span>) if orig_model.has_attribute?(key)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">377</th>
  <td class="line-code diff_in">
    <pre>            new_model.send(&quot;#{key}=&quot;, orig_model.<span>send(key)</span>) if orig_model.has_attribute?(key)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">332</th>
  <th class="line-num">378</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">333</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">379</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">334</th>
  <th class="line-num">380</th>
  <td class="line-code ">
    <pre>          if orig_model.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">335</th>
  <th class="line-num">381</th>
  <td class="line-code ">
    <pre>            new_model[new_model.class.inheritance_column] = orig_model[self.class.versioned_inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">336</th>
  <th class="line-num">382</th>
  <td class="line-code ">
    <pre>          elsif new_model.is_a?(self.class.versioned_class)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">337</th>
  <th class="line-num">383</th>
  <td class="line-code ">
    <pre>            new_model[self.class.versioned_inheritance_column] = orig_model[orig_model.class.inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">338</th>
  <th class="line-num">384</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">339</th>
  <th class="line-num">385</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">340</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">386</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">341</th>
  <th class="line-num">387</th>
  <td class="line-code ">
    <pre>        # Checks whether a new version shall be saved or not.  Calls &lt;tt&gt;version_condition_met?&lt;/tt&gt; and &lt;tt&gt;changed?&lt;/tt&gt;.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">342</th>
  <th class="line-num">388</th>
  <td class="line-code ">
    <pre>        def save_version?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">343</th>
  <th class="line-num">389</th>
  <td class="line-code ">
    <pre>          version_condition_met? &amp;&amp; changed?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">344</th>
  <th class="line-num">390</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">345</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">391</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">346</th>
  <th class="line-num">392</th>
  <td class="line-code ">
    <pre>        # Checks condition set in the :if option to check whether a revision should be created or not.  Override this for
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">347</th>
  <th class="line-num">393</th>
  <td class="line-code ">
    <pre>        # custom version condition checking.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">348</th>
  <th class="line-num">394</th>
  <td class="line-code ">
    <pre>        def version_condition_met?
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">353</th>
  <th class="line-num">399</th>
  <td class="line-code ">
    <pre>            version_condition.call(self)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">354</th>
  <th class="line-num">400</th>
  <td class="line-code ">
    <pre>          else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">355</th>
  <th class="line-num">401</th>
  <td class="line-code ">
    <pre>            version_condition
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">356</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          end<span>          </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">402</th>
  <td class="line-code diff_in">
    <pre>          end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">357</th>
  <th class="line-num">403</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">358</th>
  <th class="line-num">404</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">359</th>
  <th class="line-num">405</th>
  <td class="line-code ">
    <pre>        # Executes the block with the versioning callbacks disabled.
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">378</th>
  <th class="line-num">424</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">379</th>
  <th class="line-num">425</th>
  <td class="line-code ">
    <pre>        def empty_callback() end #:nodoc:
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">380</th>
  <th class="line-num">426</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">381</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        protected<span>          </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">427</th>
  <td class="line-code diff_in">
    <pre>        protected<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">382</th>
  <th class="line-num">428</th>
  <td class="line-code ">
    <pre>          # sets the new version before saving, unless you're using optimistic locking.  In that case, let it take care of the version.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">383</th>
  <th class="line-num">429</th>
  <td class="line-code ">
    <pre>          def set_new_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">384</th>
  <th class="line-num">430</th>
  <td class="line-code ">
    <pre>            self.send(&quot;#{self.class.version_column}=&quot;, self.next_version) if new_record? || (!locking_enabled? &amp;&amp; save_version?)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">385</th>
  <th class="line-num">431</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">386</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">432</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">387</th>
  <th class="line-num">433</th>
  <td class="line-code ">
    <pre>          # Gets the next available version for the current record, or 1 for a new record
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">388</th>
  <th class="line-num">434</th>
  <td class="line-code ">
    <pre>          def next_version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">389</th>
  <th class="line-num">435</th>
  <td class="line-code ">
    <pre>            return 1 if new_record?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">390</th>
  <th class="line-num">436</th>
  <td class="line-code ">
    <pre>            (versions.calculate(:max, :version) || 0) + 1
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">391</th>
  <th class="line-num">437</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">392</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">438</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">393</th>
  <th class="line-num">439</th>
  <td class="line-code ">
    <pre>          # clears current changed attributes.  Called after save.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">394</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          def clear_<span>chang</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">395</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            self.<span>chang</span>ed_attributes = []
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">440</th>
  <td class="line-code diff_in">
    <pre>          def clear_<span>alter</span>ed_attributes
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">441</th>
  <td class="line-code diff_in">
    <pre>            self.<span>alter</span>ed_attributes = []
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">396</th>
  <th class="line-num">442</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">397</th>
  <th class="line-num">443</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">398</th>
  <th class="line-num">444</th>
  <td class="line-code ">
    <pre>          def write_changed_attribute(attr_name, attr_value)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">399</th>
  <th class="line-num">445</th>
  <td class="line-code ">
    <pre>            # Convert to db type for comparison. Avoids failing Float&lt;=&gt;String comparisons.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">400</th>
  <th class="line-num">446</th>
  <td class="line-code ">
    <pre>            attr_value_for_db = self.class.columns_hash[attr_name.to_s].type_cast(attr_value)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">401</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            (self.<span>chang</span>ed_attributes ||= []) &lt;&lt; attr_name.to_s unless self.changed?(attr_name) || self.send(attr_name) == attr_value_for_db
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">447</th>
  <td class="line-code diff_in">
    <pre>            (self.<span>alter</span>ed_attributes ||= []) &lt;&lt; attr_name.to_s unless self.changed?(attr_name) || self.send(attr_name) == attr_value_for_db
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">402</th>
  <th class="line-num">448</th>
  <td class="line-code ">
    <pre>            write_attribute(attr_name, attr_value_for_db)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">403</th>
  <th class="line-num">449</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">404</th>
  <th class="line-num">450</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">405</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        private
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">406</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          CALLBACKS.each do |attr_name| 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">407</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            alias_method &quot;orig_#{attr_name}&quot;.to_sym, attr_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">408</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">409</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">410</th>
  <th class="line-num">451</th>
  <td class="line-code ">
    <pre>        module ClassMethods
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">411</th>
  <th class="line-num">452</th>
  <td class="line-code ">
    <pre>          # Finds a specific version of a specific row of this model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">412</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          def find_version(id, version)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">413</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            find_versions(id, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">414</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              :conditions =&gt; [&quot;#{versioned_foreign_key} = ? AND version = ?&quot;, id, version], 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">415</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              :limit =&gt; 1).first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">453</th>
  <td class="line-code diff_in">
    <pre>          def find_version(id, version = nil)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">454</th>
  <td class="line-code diff_in">
    <pre>            return find(id) unless version
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">455</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">456</th>
  <td class="line-code diff_in">
    <pre>            conditions = [&quot;#{versioned_foreign_key} = ? AND version = ?&quot;, id, version]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">457</th>
  <td class="line-code diff_in">
    <pre>            options = { :conditions =&gt; conditions, :limit =&gt; 1 }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">458</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">459</th>
  <td class="line-code diff_in">
    <pre>            if result = find_versions(id, options).first
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">460</th>
  <td class="line-code diff_in">
    <pre>              result
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">461</th>
  <td class="line-code diff_in">
    <pre>            else
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">462</th>
  <td class="line-code diff_in">
    <pre>              raise RecordNotFound, &quot;Couldn't find #{name} with ID=#{id} and VERSION=#{version}&quot;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">463</th>
  <td class="line-code diff_in">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">416</th>
  <th class="line-num">464</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">417</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">465</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">418</th>
  <th class="line-num">466</th>
  <td class="line-code ">
    <pre>          # Finds versions of a specific model.  Takes an options hash like &lt;tt&gt;find&lt;/tt&gt;
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">419</th>
  <th class="line-num">467</th>
  <td class="line-code ">
    <pre>          def find_versions(id, options = {})
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">420</th>
  <th class="line-num">468</th>
  <td class="line-code ">
    <pre>            versioned_class.find :all, {
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">426</th>
  <th class="line-num">474</th>
  <td class="line-code ">
    <pre>          def versioned_columns
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">427</th>
  <th class="line-num">475</th>
  <td class="line-code ">
    <pre>            self.columns.select { |c| !non_versioned_columns.include?(c.name) }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">428</th>
  <th class="line-num">476</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">429</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">477</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">430</th>
  <th class="line-num">478</th>
  <td class="line-code ">
    <pre>          # Returns an instance of the dynamic versioned model
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">431</th>
  <th class="line-num">479</th>
  <td class="line-code ">
    <pre>          def versioned_class
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">432</th>
  <th class="line-num">480</th>
  <td class="line-code ">
    <pre>            const_get versioned_class_name
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">438</th>
  <th class="line-num">486</th>
  <td class="line-code ">
    <pre>            if !self.content_columns.find { |c| %w(version lock_version).include? c.name }
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">439</th>
  <th class="line-num">487</th>
  <td class="line-code ">
    <pre>              self.connection.add_column table_name, :version, :integer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">440</th>
  <th class="line-num">488</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">441</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">489</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">442</th>
  <th class="line-num">490</th>
  <td class="line-code ">
    <pre>            self.connection.create_table(versioned_table_name, create_table_options) do |t|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">443</th>
  <th class="line-num">491</th>
  <td class="line-code ">
    <pre>              t.column versioned_foreign_key, :integer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">444</th>
  <th class="line-num">492</th>
  <td class="line-code ">
    <pre>              t.column :version, :integer
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">445</th>
  <th class="line-num">493</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">446</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">494</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">447</th>
  <th class="line-num">495</th>
  <td class="line-code ">
    <pre>            updated_col = nil
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">448</th>
  <th class="line-num">496</th>
  <td class="line-code ">
    <pre>            self.versioned_columns.each do |col| 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">449</th>
  <th class="line-num">497</th>
  <td class="line-code ">
    <pre>              updated_col = col if !updated_col &amp;&amp; %(updated_at updated_on).include?(col.name)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">450</th>
  <th class="line-num">498</th>
  <td class="line-code ">
    <pre>              self.connection.add_column versioned_table_name, col.name, col.type, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">451</th>
  <th class="line-num">499</th>
  <td class="line-code ">
    <pre>                :limit =&gt; col.limit, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">452</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                :default =&gt; col.default
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">500</th>
  <td class="line-code diff_in">
    <pre>                :default =&gt; col.default,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">501</th>
  <td class="line-code diff_in">
    <pre>                :scale =&gt; col.scale,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">502</th>
  <td class="line-code diff_in">
    <pre>                :precision =&gt; col.precision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">453</th>
  <th class="line-num">503</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">454</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">504</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">455</th>
  <th class="line-num">505</th>
  <td class="line-code ">
    <pre>            if type_col = self.columns_hash[inheritance_column]
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">456</th>
  <th class="line-num">506</th>
  <td class="line-code ">
    <pre>              self.connection.add_column versioned_table_name, versioned_inheritance_column, type_col.type, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">457</th>
  <th class="line-num">507</th>
  <td class="line-code ">
    <pre>                :limit =&gt; type_col.limit, 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">458</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>                :default =&gt; type_col.default
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">508</th>
  <td class="line-code diff_in">
    <pre>                :default =&gt; type_col.default,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">509</th>
  <td class="line-code diff_in">
    <pre>                :scale =&gt; type_col.scale,
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">510</th>
  <td class="line-code diff_in">
    <pre>                :precision =&gt; type_col.precision
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">459</th>
  <th class="line-num">511</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">460</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">512</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">461</th>
  <th class="line-num">513</th>
  <td class="line-code ">
    <pre>            if updated_col.nil?
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">462</th>
  <th class="line-num">514</th>
  <td class="line-code ">
    <pre>              self.connection.add_column versioned_table_name, :updated_at, :timestamp
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">463</th>
  <th class="line-num">515</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">464</th>
  <th class="line-num">516</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">465</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">517</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">466</th>
  <th class="line-num">518</th>
  <td class="line-code ">
    <pre>          # Rake migration task to drop the versioned table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">467</th>
  <th class="line-num">519</th>
  <td class="line-code ">
    <pre>          def drop_versioned_table
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">468</th>
  <th class="line-num">520</th>
  <td class="line-code ">
    <pre>            self.connection.drop_table versioned_table_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">469</th>
  <th class="line-num">521</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">470</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">522</th>
  <td class="line-code diff_in">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">471</th>
  <th class="line-num">523</th>
  <td class="line-code ">
    <pre>          # Executes the block with the versioning callbacks disabled.
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">472</th>
  <th class="line-num">524</th>
  <td class="line-code ">
    <pre>          #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">473</th>
  <th class="line-num">525</th>
  <td class="line-code ">
    <pre>          #   Foo.without_revision do
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">476</th>
  <th class="line-num">528</th>
  <td class="line-code ">
    <pre>          #
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">477</th>
  <th class="line-num">529</th>
  <td class="line-code ">
    <pre>          def without_revision(&amp;block)
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">478</th>
  <th class="line-num">530</th>
  <td class="line-code ">
    <pre>            class_eval do 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">479</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>              CALLBACKS.each do |attr_name| 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">531</th>
  <td class="line-code diff_in">
    <pre>              CALLBACKS.each do |attr_name|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">532</th>
  <td class="line-code diff_in">
    <pre>                alias_method &quot;orig_#{attr_name}&quot;.to_sym, attr_name
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">480</th>
  <th class="line-num">533</th>
  <td class="line-code ">
    <pre>                alias_method attr_name, :empty_callback
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">481</th>
  <th class="line-num">534</th>
  <td class="line-code ">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">482</th>
  <th class="line-num">535</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">483</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            result = block.call
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">536</th>
  <td class="line-code diff_in">
    <pre>            block.call
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">537</th>
  <td class="line-code diff_in">
    <pre>          ensure
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">484</th>
  <th class="line-num">538</th>
  <td class="line-code ">
    <pre>            class_eval do 
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">485</th>
  <th class="line-num">539</th>
  <td class="line-code ">
    <pre>              CALLBACKS.each do |attr_name|
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">486</th>
  <th class="line-num">540</th>
  <td class="line-code ">
    <pre>                alias_method attr_name, &quot;orig_#{attr_name}&quot;.to_sym
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">487</th>
  <th class="line-num">541</th>
  <td class="line-code ">
    <pre>              end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">488</th>
  <th class="line-num">542</th>
  <td class="line-code ">
    <pre>            end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">489</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            result
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">490</th>
  <th class="line-num">543</th>
  <td class="line-code ">
    <pre>          end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">491</th>
  <th class="line-num">544</th>
  <td class="line-code ">
    <pre>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">492</th>
  <th class="line-num">545</th>
  <td class="line-code ">
    <pre>          # Turns off optimistic locking for the duration of the block
</pre>
  </td>
</tr>

<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">501</th>
  <th class="line-num">554</th>
  <td class="line-code ">
    <pre>            result = block.call
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">502</th>
  <th class="line-num">555</th>
  <td class="line-code ">
    <pre>            ActiveRecord::Base.lock_optimistically = true if current
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">503</th>
  <th class="line-num">556</th>
  <td class="line-code ">
    <pre>            result
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">504</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>          end<span>          </span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num"></th>
  <th class="line-num">557</th>
  <td class="line-code diff_in">
    <pre>          end<span></span>
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">505</th>
  <th class="line-num">558</th>
  <td class="line-code ">
    <pre>        end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">506</th>
  <th class="line-num">559</th>
  <td class="line-code ">
    <pre>      end
</pre>
  </td>
</tr>

<tr>
  <th class="line-num">507</th>
  <th class="line-num">560</th>
  <td class="line-code ">
    <pre>    end
</pre>
  </td>
</tr>
</tbody>
</table>
</div>




<p class="other-formats">(Other formats not available in this archive.</p>




        
        <div style="clear:both;"></div>
    </div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="http://www.redmine.org/">Redmine</a> &copy; 2006-2012 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>

<!-- Mirrored from redmine.ogf.org/projects/redmine-og/repository/revisions/7cdd88a6ce3632c801223b33e5ccc2b9fc13651e/diff/vendor/plugins/acts_as_versioned/lib/acts_as_versioned.rb by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 29 Sep 2022 22:40:22 GMT -->
</html>
